import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as a,c as s,e as t}from"./app-058042d0.js";const e={},p=t(`<h2 id="arraylistæ‰©å®¹åŸç†" tabindex="-1"><a class="header-anchor" href="#arraylistæ‰©å®¹åŸç†" aria-hidden="true">#</a> ArrayListæ‰©å®¹åŸç†</h2><p>å½“æˆ‘ä»¬å†™ä¸‹äº†å¦‚ä¸‹ä»£ç <br><code>ArrayList&lt;Integer&gt; list = new ArrayList&lt;&gt;();</code><br> è°ƒç”¨äº†ArrayListç±»çš„æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªArrayListå¯¹è±¡å®ä¾‹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> <span class="token constant">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¹¶ä¸”ç»™Object[] elementDataï¼ˆç”¨äºå­˜å‚¨æ•°ç»„åˆ—è¡¨å…ƒç´ çš„æ•°ç»„ï¼‰ä¸€ä¸ªåˆå§‹çš„ç©ºæ•°ç»„ã€‚</p><p>å½“æˆ‘ä»¬è°ƒç”¨äº†addæ–¹æ³•å°†æŒ‡å®šçš„å…ƒç´ æ·»åŠ åˆ°elementDataæœ«å°¾çš„æ—¶å€™<br> addæ–¹æ³•å¦‚ä¸‹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚
*/</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ·»åŠ å…ƒç´ ä¹‹å‰ï¼Œå…ˆè°ƒç”¨ensureCapacityInternalæ–¹æ³•</span>
    <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Increments modCount!!</span>
	<span class="token comment">//è¿™é‡Œçœ‹åˆ°ArrayListæ·»åŠ å…ƒç´ çš„å®è´¨å°±ç›¸å½“äºä¸ºæ•°ç»„èµ‹å€¼</span>
	elementData<span class="token punctuation">[</span>size<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç®€å•æ¥è¯´åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ ä¹‹å‰å…ˆè¿›è¡Œæ‰©å®¹ï¼Œå…·ä½“è°ƒç”¨äº†<br><code>ensureCapacityInternal(size + 1)</code>æ–¹æ³•å¾—åˆ°æœ€å°æ‰©å®¹é‡<br> åœ¨æ¥ç€çœ‹ä¸Šé¢ğŸ‘†ğŸ»çš„æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//å¾—åˆ°æœ€å°æ‰©å®¹é‡</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData <span class="token operator">==</span> <span class="token constant">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token comment">// è·å–é»˜è®¤çš„å®¹é‡å’Œä¼ å…¥å‚æ•°çš„è¾ƒå¤§å€¼</span>
    	minCapacity <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_CAPACITY</span><span class="token punctuation">,</span> minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">ensureExplicitCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>è¯¥æ–¹æ³•çš„å‚æ•°minCapacityä¸º1ï¼Œè°ƒç”¨Math.max(DEFAULT_CAPACITY, minCapacity);æ–¹æ³•ä¹‹åminCapacityä¸º10ã€‚</p></blockquote><p>æ¥ç€è°ƒç”¨<code>ensureExplicitCapacity(minCapacity);</code>æ–¹æ³•åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureExplicitCapacity</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    modCount<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token comment">// overflow-conscious code</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>minCapacity <span class="token operator">-</span> elementData<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    	<span class="token comment">//è°ƒç”¨growæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä»£è¡¨å·²ç»å¼€å§‹æ‰©å®¹äº†</span>
    	<span class="token function">grow</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºç¬¬ä¸€æ¬¡è¿™ä¸ªæ—¶å€™minCapacity=10ï¼ŒelementData.length=0ï¼›æ‰€ä»¥è‚¯å®šéœ€è¦æ‰©å®¹ï¼Œç»§ç»­è°ƒç”¨<code>grow(minCapacity)</code>æ–¹æ³•è¿›è¡Œæ‰©å®¹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* è¦åˆ†é…çš„æœ€å¤§æ•°ç»„å¤§å°
*/</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MAX_ARRAY_SIZE</span> <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span> <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
* ArrayListæ‰©å®¹çš„æ ¸å¿ƒæ–¹æ³•ã€‚
*/</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">grow</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// oldCapacityä¸ºæ—§å®¹é‡ï¼ŒnewCapacityä¸ºæ–°å®¹é‡</span>
    <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
	<span class="token comment">//å°†oldCapacity å³ç§»ä¸€ä½ï¼Œå…¶æ•ˆæœç›¸å½“äºoldCapacity /2ï¼Œ</span>
	<span class="token comment">//æˆ‘ä»¬çŸ¥é“ä½è¿ç®—çš„é€Ÿåº¦è¿œè¿œå¿«äºæ•´é™¤è¿ç®—ï¼Œæ•´å¥è¿ç®—å¼çš„ç»“æœå°±æ˜¯å°†æ–°å®¹é‡æ›´æ–°ä¸ºæ—§å®¹é‡çš„1.5å€ï¼Œ</span>
	<span class="token keyword">int</span> newCapacity <span class="token operator">=</span> oldCapacity <span class="token operator">+</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//ç„¶åæ£€æŸ¥æ–°å®¹é‡æ˜¯å¦å¤§äºæœ€å°éœ€è¦å®¹é‡ï¼Œè‹¥è¿˜æ˜¯å°äºæœ€å°éœ€è¦å®¹é‡ï¼Œé‚£ä¹ˆå°±æŠŠæœ€å°éœ€è¦å®¹é‡å½“ä½œæ•°ç»„çš„æ–°å®¹é‡ï¼Œ</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> minCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    	newCapacity <span class="token operator">=</span> minCapacity<span class="token punctuation">;</span>
	<span class="token comment">// å¦‚æœæ–°å®¹é‡å¤§äº MAX_ARRAY_SIZE,è¿›å…¥(æ‰§è¡Œ) \`hugeCapacity()\` æ–¹æ³•æ¥æ¯”è¾ƒ minCapacity å’Œ MAX_ARRAY_SIZEï¼Œ</span>
	<span class="token comment">//å¦‚æœminCapacityå¤§äºæœ€å¤§å®¹é‡ï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸º\`Integer.MAX_VALUE\`ï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZE å³ä¸º \`Integer.MAX_VALUE - 8\`ã€‚</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> <span class="token constant">MAX_ARRAY_SIZE</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    	newCapacity <span class="token operator">=</span> <span class="token function">hugeCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// minCapacity is usually close to size, so this is a win:</span>
	elementData <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1),æ‰€ä»¥ ArrayList æ¯æ¬¡æ‰©å®¹ä¹‹åå®¹é‡éƒ½ä¼šå˜ä¸ºåŸæ¥çš„ 1.5 å€å·¦å³ï¼ˆoldCapacity ä¸ºå¶æ•°å°±æ˜¯ 1.5 å€ï¼Œå¦åˆ™æ˜¯ 1.5 å€å·¦å³ï¼‰ï¼</strong> å¥‡å¶ä¸åŒï¼Œæ¯”å¦‚ ï¼š10+10/2 = 15, 33+33/2=49ã€‚å¦‚æœæ˜¯å¥‡æ•°çš„è¯ä¼šä¸¢æ‰å°æ•°.</p></blockquote><ul><li>å½“ add ç¬¬ 1 ä¸ªå…ƒç´ æ—¶ï¼ŒoldCapacity ä¸º 0ï¼Œç»æ¯”è¾ƒåç¬¬ä¸€ä¸ª if åˆ¤æ–­æˆç«‹ï¼ŒnewCapacity = minCapacity(ä¸º 10)ã€‚ä½†æ˜¯ç¬¬äºŒä¸ª if åˆ¤æ–­ä¸ä¼šæˆç«‹ï¼Œå³ newCapacity ä¸æ¯” MAX_ARRAY_SIZE å¤§ï¼Œåˆ™ä¸ä¼šè¿›å…¥ hugeCapacity æ–¹æ³•ã€‚æ•°ç»„å®¹é‡ä¸º 10ï¼Œadd æ–¹æ³•ä¸­ return true,size å¢ä¸º 1ã€‚</li><li>å½“ add ç¬¬ 11 ä¸ªå…ƒç´ è¿›å…¥ grow æ–¹æ³•æ—¶ï¼ŒnewCapacity ä¸º 15ï¼Œæ¯” minCapacityï¼ˆä¸º 11ï¼‰å¤§ï¼Œç¬¬ä¸€ä¸ª if åˆ¤æ–­ä¸æˆç«‹ã€‚æ–°å®¹é‡æ²¡æœ‰å¤§äºæ•°ç»„æœ€å¤§ sizeï¼Œä¸ä¼šè¿›å…¥ hugeCapacity æ–¹æ³•ã€‚æ•°ç»„å®¹é‡æ‰©ä¸º 15ï¼Œadd æ–¹æ³•ä¸­ return true,size å¢ä¸º 11ã€‚</li><li>ä»¥æ­¤ç±»æ¨Â·Â·Â·</li></ul><p>æ€»ç»“ï¼š</p><blockquote><p>Qï¼šè¯´ä¸€è¯´ArrayListçš„æ‰©å®¹æœºåˆ¶å§ã€‚<br> Aï¼šå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªArrayListå¯¹è±¡çš„æ—¶å€™ï¼Œåº•å±‚å…¶å®æ˜¯ä¸€ä¸ªObjectæ•°ç»„å¹¶ä¸”åœ¨æˆ‘ä»¬åˆ›å»ºçš„æ—¶å€™è¿›è¡Œäº†åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„ï¼›<br> å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨addæ–¹æ³•è¿›è¡Œæ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šè°ƒç”¨<code>Arrays.copyOf</code>æ–¹æ³•å¯¹æ•°ç»„è¿›è¡Œä¸€ä¸ªé•¿åº¦ä¸º10çš„æ‰©å®¹ï¼Œæ‰©å®¹å®Œæ¯•ä¹‹åå†è¿›è¡Œsize++å’Œå…ƒç´ çš„æ·»åŠ ã€‚<br> ç„¶åç¬¬äºŒæ¬¡è°ƒç”¨addæ–¹æ³•è¿›è¡Œæ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œå› ä¸ºå½“å‰æ‰€éœ€å®¹é‡å°äº10æ‰€ä»¥ä¸éœ€è¦æ‰©å®¹ã€‚<br> å½“æ·»åŠ åˆ°ç¬¬11ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå› ä¸ºè¶…è¿‡æ•°ç»„çš„é•¿åº¦10ï¼Œæ‰€ä»¥ä¼šæŒ‰ç…§åŸå…ˆçš„1.5å€å·¦å³è¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹å®Œæ¯•ä¹‹åå†è¿›è¡Œsize++å’Œå…ƒç´ çš„æ·»åŠ ã€‚<br> Â·Â·Â·Â·Â·Â·</p></blockquote>`,17),c=[p];function i(o,l){return a(),s("div",null,c)}const d=n(e,[["render",i],["__file","arraylist-source-code.html.vue"]]);export{d as default};
