<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://www.javaworld.top/docker/Docker.html"><meta property="og:site_name" content="JavaWorld"><meta property="og:title" content="Docker"><meta property="og:description" content="这篇文章是2023年温习Docker容器，对Docker旧 (http://wuluwulu.cn/archives/docker)文章的整理和优化，请放心食用~ Docker介绍 谈一谈Docker为什么比VM虚拟机快？？！！ 1. docker有比虚拟机更少的抽象层 ​	由于docker不需要虚拟机实现硬件资源虚拟化，运行在docker容器上的程序..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-10-07T01:41:42.000Z"><meta property="article:author" content="Hu Meng"><meta property="article:tag" content="Docker"><meta property="article:modified_time" content="2023-10-07T01:41:42.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Docker","image":[""],"dateModified":"2023-10-07T01:41:42.000Z","author":[{"@type":"Person","name":"Hu Meng","url":"https://github.com/humeng1010"}]}</script><meta name="referrer" content="no-referrer"><title>Docker | JavaWorld</title><meta name="description" content="这篇文章是2023年温习Docker容器，对Docker旧 (http://wuluwulu.cn/archives/docker)文章的整理和优化，请放心食用~ Docker介绍 谈一谈Docker为什么比VM虚拟机快？？！！ 1. docker有比虚拟机更少的抽象层 ​	由于docker不需要虚拟机实现硬件资源虚拟化，运行在docker容器上的程序...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-80ba13d1.css" as="style"><link rel="stylesheet" href="/assets/style-80ba13d1.css">
    <link rel="modulepreload" href="/assets/app-b5397d92.js"><link rel="modulepreload" href="/assets/Docker.html-a70b5843.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/assets/Docker.html-80ee6ee7.js"><link rel="prefetch" href="/assets/index.html-6e614ddd.js" as="script"><link rel="prefetch" href="/assets/home.html-9f114826.js" as="script"><link rel="prefetch" href="/assets/index.html-6e614ddd.js" as="script"><link rel="prefetch" href="/assets/interview-summary.html-cc182145.js" as="script"><link rel="prefetch" href="/assets/index.html-29a01e5e.js" as="script"><link rel="prefetch" href="/assets/JDBC.html-6f4bae21.js" as="script"><link rel="prefetch" href="/assets/Maven.html-53def3bb.js" as="script"><link rel="prefetch" href="/assets/MyBatis.html-d7f2960a.js" as="script"><link rel="prefetch" href="/assets/web-core-content.html-a968cb9c.js" as="script"><link rel="prefetch" href="/assets/deploying-various-software.html-48881b87.js" as="script"><link rel="prefetch" href="/assets/linux-common-commands.html-551da65b.js" as="script"><link rel="prefetch" href="/assets/linux-nohup-_.html-ce631928.js" as="script"><link rel="prefetch" href="/assets/one-week-learning-linux.html-15ea6d24.js" as="script"><link rel="prefetch" href="/assets/use-docker-to-deploy-backend-separation-projects.html-72a5c542.js" as="script"><link rel="prefetch" href="/assets/mysql-basis.html-364efa1a.js" as="script"><link rel="prefetch" href="/assets/basis-project-ruiji-tackout.html-00d5c009.js" as="script"><link rel="prefetch" href="/assets/index.html-8e2f47a3.js" as="script"><link rel="prefetch" href="/assets/SpringBoot原理篇.html-167b5eb6.js" as="script"><link rel="prefetch" href="/assets/SpringBoot基础篇.html-6a5410ae.js" as="script"><link rel="prefetch" href="/assets/SpringBoot开发实用篇.html-c5b0d73b.js" as="script"><link rel="prefetch" href="/assets/SpringBoot运维实用篇.html-52ecdcae.js" as="script"><link rel="prefetch" href="/assets/maven-advance.html-e1aabae3.js" as="script"><link rel="prefetch" href="/assets/mybatis-plus.html-322ac73b.js" as="script"><link rel="prefetch" href="/assets/spring-mvc.html-83fcb80b.js" as="script"><link rel="prefetch" href="/assets/spring.html-ec8a6378.js" as="script"><link rel="prefetch" href="/assets/springboot.html-cf9cb36b.js" as="script"><link rel="prefetch" href="/assets/interview-process-01.html-3fd1be57.js" as="script"><link rel="prefetch" href="/assets/decorative-pattern.html-1f3529f7.js" as="script"><link rel="prefetch" href="/assets/dynamic-proxy.html-b6583392.js" as="script"><link rel="prefetch" href="/assets/exception.html-36db454e.js" as="script"><link rel="prefetch" href="/assets/factory-pattern.html-4fe4655e.js" as="script"><link rel="prefetch" href="/assets/java-basic-land-01.html-da620e28.js" as="script"><link rel="prefetch" href="/assets/java-basic-land-02.html-c3ef3b71.js" as="script"><link rel="prefetch" href="/assets/java-basic-land-03.html-21aba2ca.js" as="script"><link rel="prefetch" href="/assets/reflection.html-785d49d4.js" as="script"><link rel="prefetch" href="/assets/regular-expression.html-c08bed2c.js" as="script"><link rel="prefetch" href="/assets/stream.html-a025f125.js" as="script"><link rel="prefetch" href="/assets/xml-tag.html-54d0374c.js" as="script"><link rel="prefetch" href="/assets/arraylist-source-code.html-f9e93779.js" as="script"><link rel="prefetch" href="/assets/java-collection-land-01.html-a2eac483.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-land-01.html-8f3cb305.js" as="script"><link rel="prefetch" href="/assets/io-basis.html-d5fb56d5.js" as="script"><link rel="prefetch" href="/assets/network-program.html-fbe19fa3.js" as="script"><link rel="prefetch" href="/assets/java8-common-new-features.html-6cab395f.js" as="script"><link rel="prefetch" href="/assets/404.html-0a613560.js" as="script"><link rel="prefetch" href="/assets/index.html-a311aa74.js" as="script"><link rel="prefetch" href="/assets/index.html-f5aaeff4.js" as="script"><link rel="prefetch" href="/assets/index.html-7502b0d7.js" as="script"><link rel="prefetch" href="/assets/index.html-dca87e01.js" as="script"><link rel="prefetch" href="/assets/index.html-bd42ed45.js" as="script"><link rel="prefetch" href="/assets/index.html-b78f2cb0.js" as="script"><link rel="prefetch" href="/assets/index.html-9f000c25.js" as="script"><link rel="prefetch" href="/assets/index.html-c77ba655.js" as="script"><link rel="prefetch" href="/assets/index.html-7cd448f1.js" as="script"><link rel="prefetch" href="/assets/index.html-a8e6f4da.js" as="script"><link rel="prefetch" href="/assets/index.html-0ab1164b.js" as="script"><link rel="prefetch" href="/assets/index.html-332b9135.js" as="script"><link rel="prefetch" href="/assets/index.html-7512bda1.js" as="script"><link rel="prefetch" href="/assets/index.html-b4d4689f.js" as="script"><link rel="prefetch" href="/assets/index.html-7f277e55.js" as="script"><link rel="prefetch" href="/assets/home.html-3dd13144.js" as="script"><link rel="prefetch" href="/assets/index.html-7f277e55.js" as="script"><link rel="prefetch" href="/assets/interview-summary.html-4f9d5e83.js" as="script"><link rel="prefetch" href="/assets/index.html-42a5ed34.js" as="script"><link rel="prefetch" href="/assets/JDBC.html-11c95e29.js" as="script"><link rel="prefetch" href="/assets/Maven.html-ad313d72.js" as="script"><link rel="prefetch" href="/assets/MyBatis.html-16dcdbf8.js" as="script"><link rel="prefetch" href="/assets/web-core-content.html-81d4dd57.js" as="script"><link rel="prefetch" href="/assets/deploying-various-software.html-dd5d8048.js" as="script"><link rel="prefetch" href="/assets/linux-common-commands.html-c14801a1.js" as="script"><link rel="prefetch" href="/assets/linux-nohup-_.html-7e6703b4.js" as="script"><link rel="prefetch" href="/assets/one-week-learning-linux.html-9c063b5a.js" as="script"><link rel="prefetch" href="/assets/use-docker-to-deploy-backend-separation-projects.html-92dde50f.js" as="script"><link rel="prefetch" href="/assets/mysql-basis.html-c4df24a8.js" as="script"><link rel="prefetch" href="/assets/basis-project-ruiji-tackout.html-11554ed2.js" as="script"><link rel="prefetch" href="/assets/index.html-a86adb69.js" as="script"><link rel="prefetch" href="/assets/SpringBoot原理篇.html-4b854759.js" as="script"><link rel="prefetch" href="/assets/SpringBoot基础篇.html-6ddb9607.js" as="script"><link rel="prefetch" href="/assets/SpringBoot开发实用篇.html-f94fc524.js" as="script"><link rel="prefetch" href="/assets/SpringBoot运维实用篇.html-471fd5ce.js" as="script"><link rel="prefetch" href="/assets/maven-advance.html-3076eaef.js" as="script"><link rel="prefetch" href="/assets/mybatis-plus.html-45d6ca3a.js" as="script"><link rel="prefetch" href="/assets/spring-mvc.html-3e3a6cd7.js" as="script"><link rel="prefetch" href="/assets/spring.html-d855b5fc.js" as="script"><link rel="prefetch" href="/assets/springboot.html-938d9c25.js" as="script"><link rel="prefetch" href="/assets/interview-process-01.html-c3cfcfc7.js" as="script"><link rel="prefetch" href="/assets/decorative-pattern.html-ea7c532f.js" as="script"><link rel="prefetch" href="/assets/dynamic-proxy.html-f9239b9b.js" as="script"><link rel="prefetch" href="/assets/exception.html-b96a4567.js" as="script"><link rel="prefetch" href="/assets/factory-pattern.html-71332486.js" as="script"><link rel="prefetch" href="/assets/java-basic-land-01.html-fadf35e6.js" as="script"><link rel="prefetch" href="/assets/java-basic-land-02.html-9316cc87.js" as="script"><link rel="prefetch" href="/assets/java-basic-land-03.html-733ba3c3.js" as="script"><link rel="prefetch" href="/assets/reflection.html-3d15822c.js" as="script"><link rel="prefetch" href="/assets/regular-expression.html-f6ebbf83.js" as="script"><link rel="prefetch" href="/assets/stream.html-6367fec9.js" as="script"><link rel="prefetch" href="/assets/xml-tag.html-f7451826.js" as="script"><link rel="prefetch" href="/assets/arraylist-source-code.html-c78b5ddf.js" as="script"><link rel="prefetch" href="/assets/java-collection-land-01.html-b00d142e.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-land-01.html-5bd31ee7.js" as="script"><link rel="prefetch" href="/assets/io-basis.html-ff10bc34.js" as="script"><link rel="prefetch" href="/assets/network-program.html-38e6515c.js" as="script"><link rel="prefetch" href="/assets/java8-common-new-features.html-ecf37dae.js" as="script"><link rel="prefetch" href="/assets/404.html-3fd36c95.js" as="script"><link rel="prefetch" href="/assets/index.html-10ff84ce.js" as="script"><link rel="prefetch" href="/assets/index.html-352e208b.js" as="script"><link rel="prefetch" href="/assets/index.html-dd60a066.js" as="script"><link rel="prefetch" href="/assets/index.html-9cd740aa.js" as="script"><link rel="prefetch" href="/assets/index.html-ed5fa4a6.js" as="script"><link rel="prefetch" href="/assets/index.html-a3576af1.js" as="script"><link rel="prefetch" href="/assets/index.html-e5182d02.js" as="script"><link rel="prefetch" href="/assets/index.html-25336273.js" as="script"><link rel="prefetch" href="/assets/index.html-5463b56a.js" as="script"><link rel="prefetch" href="/assets/index.html-31f4d52d.js" as="script"><link rel="prefetch" href="/assets/index.html-153ba576.js" as="script"><link rel="prefetch" href="/assets/index.html-75e8d0c4.js" as="script"><link rel="prefetch" href="/assets/index.html-19d37b03.js" as="script"><link rel="prefetch" href="/assets/index.html-32f1e89c.js" as="script"><link rel="prefetch" href="/assets/auto-fe80bb03.js" as="script"><link rel="prefetch" href="/assets/index-2bf332f6.js" as="script"><link rel="prefetch" href="/assets/flowchart-c441f34d.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-d43da08c.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-9d5bc2ce.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-1a4c3ae7.js" as="script"><link rel="prefetch" href="/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-c17a4024.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-5762295a.js" as="script"><link rel="prefetch" href="/assets/SearchResult-de5b4a8c.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/"><img class="vp-nav-logo" src="/logo.png" alt="JavaWorld"><!----><span class="vp-site-name hide-in-pad">JavaWorld</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="JavaWorld" class="vp-link nav-link nav-link" href="/home.html"><span class="font-icon icon iconfont icon-home" style=""></span>JavaWorld<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="项目推荐" class="vp-link nav-link nav-link" href="/project-recommend/"><span class="font-icon icon iconfont icon-back-stage" style=""></span>项目推荐<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="面试海岛" class="vp-link nav-link nav-link" href="/interview/"><span class="font-icon icon iconfont icon-window" style=""></span>面试海岛<!----></a></div><div class="nav-item hide-in-mobile"><a href="http://wuluwulu.cn" rel="noopener noreferrer" target="_blank" aria-label="V1 博客" class="nav-link"><span class="font-icon icon iconfont icon-blog" style=""></span>V1 博客<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/humeng1010/Java-world" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-mysql" style=""></span><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-chrome" style=""></span><span class="vp-sidebar-title">JavaWeb</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-centos" style=""></span><span class="vp-sidebar-title">Linux</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-type" style=""></span><span class="vp-sidebar-title">SSM框架</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-structure" style=""></span><span class="vp-sidebar-title">SpringBoot</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-module" style=""></span><span class="vp-sidebar-title">Docker</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a aria-label="Docker" class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active nav-link active vp-sidebar-link vp-sidebar-page active" href="/docker/Docker.html"><!---->Docker<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="Docker介绍" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#docker介绍"><!---->Docker介绍<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="谈一谈Docker为什么比VM虚拟机快？？！！" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#谈一谈docker为什么比vm虚拟机快"><!---->谈一谈Docker为什么比VM虚拟机快？？！！<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="Docker命令" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#docker命令"><!---->Docker命令<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="镜像命令" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#镜像命令"><!---->镜像命令<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="谈一谈虚悬镜像是什么？" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#谈一谈虚悬镜像是什么"><!---->谈一谈虚悬镜像是什么？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="容器命令" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#容器命令"><!---->容器命令<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="Docker镜像" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#docker镜像"><!---->Docker镜像<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="Docker镜像分层结构" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#docker镜像分层结构"><!---->Docker镜像分层结构<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="Docker镜像commit命令案例" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#docker镜像commit命令案例"><!---->Docker镜像commit命令案例<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="Docker本地镜像发布到阿里云" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#docker本地镜像发布到阿里云"><!---->Docker本地镜像发布到阿里云<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="Docker私有库" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#docker私有库"><!---->Docker私有库<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="容器数据卷" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#容器数据卷"><!---->容器数据卷<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="是什么？" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#是什么"><!---->是什么？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="能干嘛？" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#能干嘛"><!---->能干嘛？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="宿主机和容器之间映射添加容器卷" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#宿主机和容器之间映射添加容器卷"><!---->宿主机和容器之间映射添加容器卷<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="容器和宿主机之间数据共享" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#容器和宿主机之间数据共享"><!---->容器和宿主机之间数据共享<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="容器卷ro和rw读写规则" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#容器卷ro和rw读写规则"><!---->容器卷ro和rw读写规则<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="容器卷的继承" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#容器卷的继承"><!---->容器卷的继承<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="Docker软件安装" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#docker软件安装"><!---->Docker软件安装<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="总体步骤" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#总体步骤"><!---->总体步骤<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="安装Tomcat" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#安装tomcat"><!---->安装Tomcat<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="安装MySQL" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#安装mysql"><!---->安装MySQL<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="安装Redis" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#安装redis"><!---->安装Redis<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="安装Nginx" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#安装nginx"><!---->安装Nginx<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="Redis高级篇" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#redis高级篇"><!---->Redis高级篇<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="安装MySQL主从复制" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#安装mysql主从复制"><!---->安装MySQL主从复制<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="安装Redis集群(大厂面试题-分布式存储案例)" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/docker/Docker.html#安装redis集群-大厂面试题-分布式存储案例"><!---->安装Redis集群(大厂面试题-分布式存储案例)<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Docker</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/humeng1010" target="_blank" rel="noopener noreferrer">Hu Meng</a></span><span property="author" content="Hu Meng"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-10-07T01:41:42.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 40 分钟</span><meta property="timeRequired" content="PT40M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category4" role>Docker</span><!--]--><meta property="articleSection" content="Docker"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag4" role>Docker</span><!--]--><meta property="keywords" content="Docker"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#docker介绍">Docker介绍</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#谈一谈docker为什么比vm虚拟机快">谈一谈Docker为什么比VM虚拟机快？？！！</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#docker命令">Docker命令</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#镜像命令">镜像命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#谈一谈虚悬镜像是什么">谈一谈虚悬镜像是什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#容器命令">容器命令</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#docker镜像">Docker镜像</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#docker镜像分层结构">Docker镜像分层结构</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#docker镜像commit命令案例">Docker镜像commit命令案例</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#docker本地镜像发布到阿里云">Docker本地镜像发布到阿里云</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#docker私有库">Docker私有库</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#容器数据卷">容器数据卷</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#是什么">是什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#能干嘛">能干嘛？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#宿主机和容器之间映射添加容器卷">宿主机和容器之间映射添加容器卷</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#容器和宿主机之间数据共享">容器和宿主机之间数据共享</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#容器卷ro和rw读写规则">容器卷ro和rw读写规则</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#容器卷的继承">容器卷的继承</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#docker软件安装">Docker软件安装</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#总体步骤">总体步骤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#安装tomcat">安装Tomcat</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#安装mysql">安装MySQL</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#安装redis">安装Redis</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#安装nginx">安装Nginx</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#redis高级篇">Redis高级篇</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#安装mysql主从复制">安装MySQL主从复制</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#安装redis集群-大厂面试题-分布式存储案例">安装Redis集群(大厂面试题-分布式存储案例)</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="docker2023" tabindex="-1"><a class="header-anchor" href="#docker2023" aria-hidden="true">#</a> Docker2023</h1><blockquote><p>这篇文章是2023年温习Docker容器，对<a href="http://wuluwulu.cn/archives/docker" target="_blank" rel="noopener noreferrer">Docker旧<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>文章的整理和优化，请放心食用~</p></blockquote><h2 id="docker介绍" tabindex="-1"><a class="header-anchor" href="#docker介绍" aria-hidden="true">#</a> Docker介绍</h2><h3 id="谈一谈docker为什么比vm虚拟机快" tabindex="-1"><a class="header-anchor" href="#谈一谈docker为什么比vm虚拟机快" aria-hidden="true">#</a> 谈一谈Docker为什么比VM虚拟机快？？！！</h3><ol><li><p><code>docker有比虚拟机更少的抽象层</code></p><blockquote><p>​ 由于docker<code>不需要虚拟机实现硬件资源虚拟化</code>，运行在<code>docker容器上的程序直接使用的都是实际的物理机的硬件资源</code>。因此在CPU、内存利用率上docker将会在效率上有明显优势。</p></blockquote></li><li><p><code>docker利用的是宿主机的内核，而不需要加载操作系统OS内核</code></p><blockquote><p>​ 当新建一个容器的时候，<code>docker不需要和虚拟机一样重新加载一个操作系统内核</code>；进而避免加载操作系统等费时费资源的过程，当新建一个虚拟机时，虚拟机软件需要加载OS，返回新建过程是分钟级别的。而<code>docker由于直接利用宿主机的操作系统，则省略了返回过程，因此新建一个docker容器只需要几秒钟！！</code></p></blockquote></li></ol><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304241906192.png" alt="docker" tabindex="0" loading="lazy"><figcaption>docker</figcaption></figure><h2 id="docker命令" tabindex="-1"><a class="header-anchor" href="#docker命令" aria-hidden="true">#</a> Docker命令</h2><h3 id="镜像命令" tabindex="-1"><a class="header-anchor" href="#镜像命令" aria-hidden="true">#</a> 镜像命令</h3><ul><li><p>docker images [-a -q] 显示本地仓库的镜像</p><ul><li>-a:列出本地所有镜像</li><li>-q:只显示镜像ID</li></ul><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304242057202.png" alt="image-20230424205737146" tabindex="0" loading="lazy"><figcaption>image-20230424205737146</figcaption></figure></li><li><p>docker search xxx [--limit x] 搜索某个镜像</p><blockquote><p><code>docker search xxx --limit 5</code>显示前五个搜索结果</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304242056768.png" alt="image-20230424205623659" tabindex="0" loading="lazy"><figcaption>image-20230424205623659</figcaption></figure></blockquote></li><li><p>docker pull 镜像名称[:TAG版本号] 拉取镜像</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304242105431.png" alt="image-20230424210522392" tabindex="0" loading="lazy"><figcaption>image-20230424210522392</figcaption></figure><blockquote><p>不加版本号则默认是最新的版本latest</p></blockquote></li><li><p>docker system df 查看容器、镜像、数据卷所占的空间</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304242113216.png" alt="image-20230424211340169" tabindex="0" loading="lazy"><figcaption>image-20230424211340169</figcaption></figure><blockquote><p>与操作系统的命令很类似：<code>df -h</code> 使用df命令查看磁盘的使用情况</p></blockquote></li><li><p>docker rmi [-f] <code>镜像</code>ID或名称 删除镜像(rmi -&gt; remove image)</p><ul><li>-f:强制删除，一般用于当前镜像创建了容器之后，容器没有先删除的情况下我们直接删除镜像会弹出提示，我们则需要加上-f参数强制删除；或者先去把容器删除掉。</li></ul><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304242123456.png" alt="image-20230424212343394" tabindex="0" loading="lazy"><figcaption>image-20230424212343394</figcaption></figure></li><li><p><code>docker rmi -f $(docker images -aq)</code> 删除全部镜像！</p><p>慎用，该命令会强制删除所有镜像！</p><blockquote><p>docker支持参数引用 <code>docker rmi -f $(docker images -aq)</code> 该命令的$(docker images -aq)也会被当做命令执行</p></blockquote></li></ul><h3 id="谈一谈虚悬镜像是什么" tabindex="-1"><a class="header-anchor" href="#谈一谈虚悬镜像是什么" aria-hidden="true">#</a> 谈一谈虚悬镜像是什么？</h3><p>仓库名称、标签都是<code>&lt;none&gt;</code>的镜像，俗称虚悬镜像dangling image。</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304242132607.png" alt="image-20230424213219548" tabindex="0" loading="lazy"><figcaption>image-20230424213219548</figcaption></figure><blockquote><p>这种镜像建议删除</p></blockquote><h3 id="容器命令" tabindex="-1"><a class="header-anchor" href="#容器命令" aria-hidden="true">#</a> 容器命令</h3><ul><li><p><code>docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</code> 使用镜像创建+启动容器</p><ul><li><p>OPTIONS：</p><ul><li><p><code>--name=&quot;容器新名称&quot;</code> 为容器指定一个名称；</p></li><li><p><code>-d</code>:<strong>后台运行容器</strong>并返回容器ID，也即启动守护式容器(后台运行)；</p></li><li><p><code>-i</code>:(interactive:交互)使用交互模式运行容器，通常与<code>-t</code>同时使用</p></li><li><p><code>-t</code>：(tty:伪终端)为容器重新分配一个伪终端，通常与<code>-i</code>同时使用</p><blockquote><p>即<code>-it</code><strong>启动交互式容器</strong></p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304242213839.png" alt="image-20230424221304783" tabindex="0" loading="lazy"><figcaption>image-20230424221304783</figcaption></figure><ul><li>使用<code>exit</code>退出，容器停止</li><li>使用<code>ctrl+p+q</code>退出，容器不停止</li></ul></blockquote></li><li><p><code>-P</code>：随机端口映射，大写P</p></li><li><p><code>-p</code>：<code>指定</code>端口映射，小写p</p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>-p hostPort:containerPort</td><td>端口映射 -p 8080:80</td></tr><tr><td>-p ip:hostPort:</td><td>配置监听地址 -p 10.0.0.100:8080:80</td></tr><tr><td></td><td></td></tr></tbody></table><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304242207960.png" style="zoom:33%;"></li></ul></li></ul></li><li><p>docker ps [OPTIONS]</p><ul><li>-a:列出当前所有<code>正在运行</code>的容器+<code>历史运行</code>过的</li><li>-l:显示最近创建的容器</li><li>-n:显示最近n个创建的容器<code>docker ps -n 1</code>只显示最近的一个</li><li>-q:静默模式，只显示容器编号</li></ul><blockquote><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304242227072.png" alt="image-20230424222740009" tabindex="0" loading="lazy"><figcaption>image-20230424222740009</figcaption></figure></blockquote></li><li><p><code>docker start 容器ID或者容器名称</code>启动已停止运行的容器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker start --help</span>

Usage:  <span class="token function">docker</span> start <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> CONTAINER <span class="token punctuation">[</span>CONTAINER<span class="token punctuation">..</span>.<span class="token punctuation">]</span>

Start one or <span class="token function">more</span> stopped containers

Aliases:
  <span class="token function">docker</span> container start, <span class="token function">docker</span> start

Options:
  -a, <span class="token parameter variable">--attach</span>               Attach STDOUT/STDERR and forward signals
      --detach-keys string   Override the key sequence <span class="token keyword">for</span> detaching a container
  -i, <span class="token parameter variable">--interactive</span>          Attach container&#39;s STDIN
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker start 76c75e423fa0</span>
76c75e423fa0
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED          STATUS          PORTS                                                  NAMES
76c75e423fa0   ubuntu               <span class="token string">&quot;bash&quot;</span>                   <span class="token number">19</span> minutes ago   Up <span class="token number">20</span> seconds                                                          myubuntu
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>docker restart 容器ID或者容器名称 </code>重启容器</p></li><li><p><code>docker stop 容器ID或者容器名称</code>停止容器</p></li><li><p><code>docker kill 容器ID或者容器名称</code>强制停止容器</p></li><li><p><code>docker rm 容器ID</code>删除<code>已停止</code>的容器</p></li></ul><h4 id="重要部分" tabindex="-1"><a class="header-anchor" href="#重要部分" aria-hidden="true">#</a> 重要部分</h4><p>启动守护式容器(后台服务器)</p><blockquote><p>在大部分场景下，我们希望docker的服务是后台运行的，我们可以通过-d指定容器的后台运行模式。</p><p><code>docker run -d 容器名</code></p></blockquote><p>redis前后台启动演示:</p><p>在演示之前先来一个小插曲：使用后台方式启动Ubuntu容器会发生什么事？</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 首先查看所有正在运行的容器。</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED       STATUS        PORTS            NAMES
<span class="token comment"># OK~ 发现没有任何正在运行的容器，我们直接后台启动ubuntu</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -d ubuntu</span>
4a82d76ad397a8979c29f0ea2cae666c2b55aa88dbfbefb0505b88567a303d8c
<span class="token comment"># en~弹出容器的ID了，对启动成功了哈哈~查看一下正在运行的容器</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED       STATUS        PORTS            NAMES
<span class="token comment"># 好家伙？？什么鬼我的容器呢，鲸鱼🐳背上的集装箱呢？？跑哪去了？我们加上-a参数查看所有容器</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED         STATUS                    PORTS  NAMES
4a82d76ad397   ubuntu               <span class="token string">&quot;bash&quot;</span>                   <span class="token number">7</span> seconds ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">6</span> seconds ago         tender_austin
<span class="token comment"># ??你怎么退出了呀??</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>很重要的一点：<code>Docker容器后台运行，就必须有一个前台进程！</code></p><p>容器运行的命令如果不是那些<code>一直挂起的命令</code>比如(top,tail)，就是会自动退出的。</p><p>这个是docker的机制问题，比如我们的web容器，我们以nginx为例，正常情况下，我们配置启动服务只需要启动相应的service即可。例如service nginx start。但是这样做nginx为后台进程模式运行，就导致docker前台没有运行的应用，这样的容器后台启动会立即自杀，因为他觉得他没事可做了。</p><p>所以最佳的解决方案是：将你要运行的程序以前台进程的形式运行。</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 使用交互式伪终端启动</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -it ubuntu bash</span>
<span class="token comment"># 使用快捷键退出ctrl+p+q</span>
root@e00b7cfb39c0:/<span class="token comment"># </span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token comment"># 再次查看大鲸鱼背上正在运行的容器</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED          STATUS             PORTS        NAMES
e00b7cfb39c0   ubuntu               <span class="token string">&quot;bash&quot;</span>                   <span class="token number">16</span> seconds ago   Up <span class="token number">15</span> seconds                   hungry_benz
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>因此有些镜像使用-d启动时不可以的，我们需要使用-it交互模式启动</strong></p></blockquote><p>下面我们步入正题：redis启动！</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 我们先使用-it前台启动redis</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -it redis</span>
<span class="token number">1</span>:C <span class="token number">25</span> Apr <span class="token number">2023</span> 01:16:54.832 <span class="token comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
<span class="token number">1</span>:C <span class="token number">25</span> Apr <span class="token number">2023</span> 01:16:54.832 <span class="token comment"># Redis version=7.0.10, bits=64, commit=00000000, modified=0, pid=1, just started</span>
<span class="token number">1</span>:C <span class="token number">25</span> Apr <span class="token number">2023</span> 01:16:54.832 <span class="token comment"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span>
<span class="token number">1</span>:M <span class="token number">25</span> Apr <span class="token number">2023</span> 01:16:54.833 * monotonic clock: POSIX clock_gettime
                _._                                                  
           _.-`<span class="token variable"><span class="token variable">`</span>__ <span class="token string">&#39;&#39;</span>-._                                             
      _.-<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span>    <span class="token variable">`</span></span><span class="token builtin class-name">.</span>  <span class="token variable"><span class="token variable">`</span>_.  <span class="token string">&#39;&#39;</span>-._           Redis <span class="token number">7.0</span>.10 <span class="token punctuation">(</span>00000000/0<span class="token punctuation">)</span> <span class="token number">64</span> bit
  .-<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span> .-<span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">.</span>  <span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span><span class="token punctuation">\</span>/    _.,_ <span class="token string">&#39;&#39;</span>-._                                  
 <span class="token punctuation">(</span>    &#39;      ,       .-<span class="token variable">`</span></span>  <span class="token operator">|</span> <span class="token variable"><span class="token variable">`</span>,    <span class="token punctuation">)</span>     Running <span class="token keyword">in</span> standalone mode
 <span class="token operator">|</span><span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-<span class="token punctuation">..</span>.-<span class="token variable">`</span></span> __<span class="token punctuation">..</span>.-.`<span class="token variable"><span class="token variable">`</span>-._<span class="token operator">|</span>&#39;<span class="token variable">`</span></span> _.-<span class="token string">&#39;|     Port: 6379
 |    `-._   `._    /     _.-&#39;</span>    <span class="token operator">|</span>     PID: <span class="token number">1</span>
  <span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-._  <span class="token variable"><span class="token variable">`</span>-./  _.-<span class="token string">&#39;    _.-&#39;</span>                                   
 <span class="token operator">|</span><span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-.__.-<span class="token string">&#39;    _.-&#39;</span>_.-<span class="token string">&#39;|                                  
 |    `-._`-._        _.-&#39;</span>_.-<span class="token string">&#39;    |           https://redis.io       
  `-._    `-._`-.__.-&#39;</span>_.-<span class="token string">&#39;    _.-&#39;</span>                                   
 <span class="token operator">|</span><span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-._    <span class="token variable"><span class="token variable">`</span>-.__.-<span class="token string">&#39;    _.-&#39;</span>_.-&#39;<span class="token operator">|</span>                                  
 <span class="token operator">|</span>    <span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-._        _.-<span class="token string">&#39;_.-&#39;</span>    <span class="token operator">|</span>                                  
  <span class="token variable">`</span></span>-._    <span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-.__.-<span class="token string">&#39;_.-&#39;</span>    _.-<span class="token string">&#39;                                   
      `-._    `-.__.-&#39;</span>    _.-<span class="token string">&#39;                                       
          `-._        _.-&#39;</span>                                           
              `-.__.-<span class="token string">&#39;                                               

1:M 25 Apr 2023 01:16:54.834 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.
1:M 25 Apr 2023 01:16:54.834 # Server initialized
1:M 25 Apr 2023 01:16:54.834 # WARNING Memory overcommit must be enabled! Without it, a background save or replication may fail under low memory condition. Being disabled, it can can also cause failures without low memory condition, see https://github.com/jemalloc/jemalloc/issues/1328. To fix this issue add &#39;</span>vm.overcommit_memory <span class="token operator">=</span> <span class="token number">1</span><span class="token string">&#39; to /etc/sysctl.conf and then reboot or run the command &#39;</span><span class="token function">sysctl</span> <span class="token assign-left variable">vm.overcommit_memory</span><span class="token operator">=</span><span class="token number">1</span>&#39; <span class="token keyword">for</span> this to take effect.
<span class="token number">1</span>:M <span class="token number">25</span> Apr <span class="token number">2023</span> 01:16:54.834 * Ready to accept connections
^C1:signal-handler <span class="token punctuation">(</span><span class="token number">1682385443</span><span class="token punctuation">)</span> Received SIGINT scheduling shutdown<span class="token punctuation">..</span>.
<span class="token number">1</span>:M <span class="token number">25</span> Apr <span class="token number">2023</span> 01:17:23.791 <span class="token comment"># User requested shutdown...</span>
<span class="token number">1</span>:M <span class="token number">25</span> Apr <span class="token number">2023</span> 01:17:23.791 * Saving the final RDB snapshot before exiting.
<span class="token number">1</span>:M <span class="token number">25</span> Apr <span class="token number">2023</span> 01:17:23.799 * DB saved on disk
<span class="token number">1</span>:M <span class="token number">25</span> Apr <span class="token number">2023</span> 01:17:23.799 <span class="token comment"># Redis is now ready to exit, bye bye...</span>
<span class="token comment"># 使用ctrl+c退出，查看一下所有的容器</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED          STATUS                     PORTS                                                  NAMES
86e05dadf5fc   redis                <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">36</span> seconds ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">6</span> seconds ago                                                          stupefied_murdock
<span class="token comment"># 嗯~这个容器没了，好我们使用-d后台redis</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -d redis</span>
3a94559dc6ea81b06ed67b6f5d96d30027a00afc71601d76ced40ac4189a15e5
<span class="token comment"># 查看一下启动的容器；呀？还在启动中？</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED         STATUS         PORTS                                                  NAMES
3a94559dc6ea   redis                <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">4</span> seconds ago   Up <span class="token number">4</span> seconds   <span class="token number">6379</span>/tcp                                               confident_wilson
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>那我上面的是不是写错了？</p><p>其实并没有错，因为redis启动时有前台守护进程的(就是我们上面看到的redis启动界面，我们启动redis会停止在那地方)；而Ubuntu没有前台守护进程，所以-d启动会直接退出。</p></blockquote><p>查看docker日志</p><ul><li><p><code>docker logs [OPTIONS] 容器ID</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker logs 3a94559dc6ea</span>
<span class="token number">1</span>:C <span class="token number">25</span> Apr <span class="token number">2023</span> 01:19:26.656 <span class="token comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
<span class="token number">1</span>:C <span class="token number">25</span> Apr <span class="token number">2023</span> 01:19:26.656 <span class="token comment"># Redis version=7.0.10, bits=64, commit=00000000, modified=0, pid=1, just started</span>
<span class="token number">1</span>:C <span class="token number">25</span> Apr <span class="token number">2023</span> 01:19:26.656 <span class="token comment"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span>
<span class="token number">1</span>:M <span class="token number">25</span> Apr <span class="token number">2023</span> 01:19:26.657 * monotonic clock: POSIX clock_gettime
<span class="token number">1</span>:M <span class="token number">25</span> Apr <span class="token number">2023</span> 01:19:26.658 * Running <span class="token assign-left variable">mode</span><span class="token operator">=</span>standalone, <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span>.
<span class="token number">1</span>:M <span class="token number">25</span> Apr <span class="token number">2023</span> 01:19:26.658 <span class="token comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span>
<span class="token number">1</span>:M <span class="token number">25</span> Apr <span class="token number">2023</span> 01:19:26.658 <span class="token comment"># Server initialized</span>
<span class="token number">1</span>:M <span class="token number">25</span> Apr <span class="token number">2023</span> 01:19:26.658 <span class="token comment"># WARNING Memory overcommit must be enabled! Without it, a background save or replication may fail under low memory condition. Being disabled, it can can also cause failures without low memory condition, see https://github.com/jemalloc/jemalloc/issues/1328. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.</span>
<span class="token number">1</span>:M <span class="token number">25</span> Apr <span class="token number">2023</span> 01:19:26.659 * Ready to accept connections
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Options:<br> --details Show extra details provided to logs<br> -f, --follow Follow log output<br> --since string Show logs since timestamp (e.g. &quot;2013-01-02T13:23:37Z&quot;) or relative (e.g. &quot;42m&quot; for 42 minutes)<br> -n, --tail string Number of lines to show from the end of the logs (default &quot;all&quot;)<br> -t, --timestamps Show timestamps<br> --until string Show logs before a timestamp (e.g. &quot;2013-01-02T13:23:37Z&quot;) or relative (e.g. &quot;42m&quot; for 42 minutes)</li></ul></li></ul><p>查看容器内运行的进程</p><ul><li><p><code>docker top 容器ID</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker top 3a94559dc6ea</span>
<span class="token environment constant">UID</span>                 PID                 <span class="token environment constant">PPID</span>                C                   STIME               TTY                 TIME                CMD
polkitd             <span class="token number">27113</span>               <span class="token number">27093</span>               <span class="token number">0</span>                   09:19               ?                   00:00:01            redis-server *:6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>查看容器内部细节</p><ul><li><p><code>docker inspect 容器ID</code></p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304251241933.png" alt="image-20230425124104798" tabindex="0" loading="lazy"><figcaption>image-20230425124104798</figcaption></figure></li></ul><p>进入之前创建的容器：</p><ul><li><p><code>docker exec [OPTIONS] CONTAINER COMMAND [ARG...]</code></p><p><code>docker exec -it 容器ID bashShell</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 使用交互式伪终端创建容器</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -it ubuntu bash</span>
root@83c7a25b3c35:/<span class="token comment"># ls</span>
bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
<span class="token comment"># ctrl+p+q退出容器</span>
root@83c7a25b3c35:/<span class="token comment"># [root@VM-0-5-centos ~]# </span>
<span class="token comment"># 查看正在运行的容器</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED          STATUS          PORTS                                                  NAMES
83c7a25b3c35   ubuntu               <span class="token string">&quot;bash&quot;</span>                   <span class="token number">16</span> seconds ago   Up <span class="token number">15</span> seconds                                                          tender_khayyam
<span class="token comment"># 重新进入退出的容器并使用-it交互式启动</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it 83c7a25b3c35 bash</span>
root@83c7a25b3c35:/<span class="token comment"># ls</span>
bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
root@83c7a25b3c35:/<span class="token comment"># </span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>docker attach 容器ID</code></p><p>这个命令也可以进入之前创建的容器内部</p></li></ul><blockquote><p>区别：</p><p>attach直接进入容器启动命令的终端，不会启动新的进程；用exit退出，会导致容器的停止。</p><p>exec是在容器中打开新的终端，并且可以启动新的进程；用exit退出，不会导致容器的停止。</p></blockquote><blockquote><p>演示：exec</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED          STATUS          PORTS                                                  NAMES
83c7a25b3c35   ubuntu               <span class="token string">&quot;bash&quot;</span>                   <span class="token number">10</span> minutes ago   Up <span class="token number">10</span> minutes                                                          tender_khayyam
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it 83c7a25b3c35 bash</span>
root@83c7a25b3c35:/<span class="token comment"># ls</span>
bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
root@83c7a25b3c35:/<span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED          STATUS          PORTS                                                  NAMES
83c7a25b3c35   ubuntu               <span class="token string">&quot;bash&quot;</span>                   <span class="token number">11</span> minutes ago   Up <span class="token number">10</span> minutes                                                          tender_khayyam
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>演示：attach</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED          STATUS          PORTS                                                  NAMES
83c7a25b3c35   ubuntu               <span class="token string">&quot;bash&quot;</span>                   <span class="token number">11</span> minutes ago   Up <span class="token number">10</span> minutes                                                          tender_khayyam

<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker attach 83c7a25b3c35</span>
root@83c7a25b3c35:/<span class="token comment"># ls</span>
bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
root@83c7a25b3c35:/<span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED       STATUS          PORTS                                                  NAMES
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED          STATUS                      PORTS                                                  NAMES
83c7a25b3c35   ubuntu               <span class="token string">&quot;bash&quot;</span>                   <span class="token number">16</span> minutes ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">14</span> seconds ago                                                          tender_khayyam
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>工作建议使用exec，因为退出容器终端不会导致容器停止</p></blockquote><p>练习：现在我们尝试进入redis服务：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it 3a94559dc6ea bash</span>
root@3a94559dc6ea:/data<span class="token comment"># redis-cli    </span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1 v1
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k1
<span class="token string">&quot;v1&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> del k1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k1
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">exit</span>
root@3a94559dc6ea:/data<span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED          STATUS                     PORTS                                                  NAMES
83c7a25b3c35   ubuntu               <span class="token string">&quot;bash&quot;</span>                   <span class="token number">23</span> minutes ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">7</span> minutes ago                                                          tender_khayyam
3a94559dc6ea   redis                <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">4</span> hours ago      Up <span class="token number">24</span> minutes              <span class="token number">6379</span>/tcp                                               confident_wilson
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从容器内拷贝文件到主机上</p><ul><li><p><code>docker cp 容器ID:容器内路径 目的主机的路径</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 进入正在运行的Ubuntu容器在tmp文件夹下创建一个a.txt文件并写入hello world</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it 83c7a25b3c35 bash</span>
root@83c7a25b3c35:/<span class="token comment"># ls</span>
bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
root@83c7a25b3c35:/<span class="token comment"># cd tmp</span>
root@83c7a25b3c35:/tmp<span class="token comment"># ls</span>
root@83c7a25b3c35:/tmp<span class="token comment"># touch a.txt</span>
root@83c7a25b3c35:/tmp<span class="token comment"># ls</span>
a.txt
root@83c7a25b3c35:/tmp<span class="token comment"># echo &#39;hello world&#39; &gt;&gt; a.txt </span>
root@83c7a25b3c35:/tmp<span class="token comment"># cat a.txt </span>
hello world
root@83c7a25b3c35:/tmp<span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
<span class="token comment"># 把对应的Ubuntu容器中的文件拷贝到宿主机中的当前目录下</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker cp 83c7a25b3c35:/tmp/a.txt `pwd`</span>
Successfully copied <span class="token number">2</span>.048kB to /root
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># ls</span>
a.txt  code  halo-app
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># cat a.txt </span>
hello world
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><strong>导入和导出容器</strong></p><ul><li><code>export</code>导出容器的内容作为一个tar归档文件[对应import导入命令]</li><li><code>import</code>从tar包中的内容创建一个新的文件系统再导入为镜像[对应export]</li></ul><p>案例：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">export</span> 容器ID <span class="token operator">&gt;</span> 文件名.tar
<span class="token function">cat</span> 文件名.tar <span class="token operator">|</span> <span class="token function">docker</span> <span class="token function">import</span> -镜像用户名/镜像名:镜像版本号
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED       STATUS          PORTS                                                  NAMES
83c7a25b3c35   ubuntu               <span class="token string">&quot;bash&quot;</span>                   <span class="token number">5</span> hours ago   Up <span class="token number">12</span> minutes                                                          tender_khayyam
<span class="token comment"># 导出Ubuntu容器到该路径下的abcd.tar文件</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker export 83c7a25b3c35 &gt; abcd.tar</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># ls</span>
abcd.tar  a.txt 
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED       STATUS          PORTS                                                  NAMES
83c7a25b3c35   ubuntu               <span class="token string">&quot;bash&quot;</span>                   <span class="token number">5</span> hours ago   Up <span class="token number">13</span> minutes                                                          tender_khayyam
<span class="token comment"># 强制删除容器</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker rm -f 83c7a25b3c35</span>
83c7a25b3c35
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED       STATUS        PORTS                                                  NAMES
<span class="token comment"># 导入刚刚打包好的容器作为镜像文件</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># cat abcd.tar | docker import - root/ubuntu:3.7</span>
sha256:075f11130823815fb43117cf2cd413f1ba9605779ebfd76197527f4b1b7c9d1a
<span class="token comment"># 查看镜像，第一个就是我们刚刚导入的镜像</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY      TAG       IMAGE ID       CREATED          SIZE
root/ubuntu     <span class="token number">3.7</span>       075f11130823   <span class="token number">19</span> seconds ago   <span class="token number">72</span>.8MB
redis           latest    31f08b90668e   <span class="token number">4</span> weeks ago      117MB
ubuntu          latest    ba6acccedd29   <span class="token number">18</span> months ago    <span class="token number">72</span>.8MB
<span class="token comment"># 启动该镜像，查看a.txt还在不在</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -it 075f11130823 bash</span>
root@a39afdbfb20c:/<span class="token comment"># ls</span>
bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
root@a39afdbfb20c:/<span class="token comment"># cd tmp/</span>
root@a39afdbfb20c:/tmp<span class="token comment"># ll</span>
total <span class="token number">12</span>
drwxrwxrwt <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">25</span> <span class="token number">10</span>:23 ./
drwxr-xr-x <span class="token number">1</span> root root <span class="token number">4096</span> Apr <span class="token number">25</span> <span class="token number">10</span>:37 <span class="token punctuation">..</span>/
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">12</span> Apr <span class="token number">25</span> <span class="token number">10</span>:23 a.txt
root@a39afdbfb20c:/tmp<span class="token comment"># cat a.txt </span>
hello world
root@a39afdbfb20c:/tmp<span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="docker镜像" tabindex="-1"><a class="header-anchor" href="#docker镜像" aria-hidden="true">#</a> Docker镜像</h2><h3 id="docker镜像分层结构" tabindex="-1"><a class="header-anchor" href="#docker镜像分层结构" aria-hidden="true">#</a> Docker镜像分层结构</h3><p>Docker镜像采用分层结构。</p><h4 id="谈一谈为什么docker镜像采用分层结构呢" tabindex="-1"><a class="header-anchor" href="#谈一谈为什么docker镜像采用分层结构呢" aria-hidden="true">#</a> 谈一谈为什么Docker镜像采用分层结构呢？</h4><blockquote><p>分层结构最大的好处就是共享资源，方便复制迁移，就是为了复用。</p><p>比如说有多个镜像都从相同的base镜像构建而来，那么DockerHost只需要在磁盘上保存一份base镜像；</p><p>同时内存中也只需加载一份base镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。</p></blockquote><h3 id="docker镜像commit命令案例" tabindex="-1"><a class="header-anchor" href="#docker镜像commit命令案例" aria-hidden="true">#</a> Docker镜像commit命令案例</h3><ul><li><p><code>docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</code></p><ul><li><code>-a</code>, --author string Author (e.g., &quot;John Hannibal Smith <a href="mailto:hannibal@a-team.com">hannibal@a-team.com</a>&quot;)</li><li>-c, --change list Apply Dockerfile instruction to the created image</li><li><code>-m</code>, --message string Commit message</li><li>-p, --pause Pause container during commit (default true) # 提交之间暂停容器？</li></ul><blockquote><p>示例：<code>docker commit -m &quot;add vim cmd&quot; -a &quot;tom&quot; 770baa5b1071 tom/myubuntu:1.3</code></p></blockquote></li></ul><p>本小结将基于案例的方式来演示：</p><blockquote><p>由于docker pull ubuntu得到的ubuntu镜像是一个不完整的系统，比如vim命令就没有，我们现在打算自定义一个集成了vim命令的ubuntu系统并commit到仓库</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED        STATUS        PORTS                                                  NAMES
770baa5b1071   ubuntu         <span class="token string">&quot;bash&quot;</span>                   <span class="token number">24</span> hours ago   Up <span class="token number">24</span> hours                                                          upbeat_morse

<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it 770baa5b1071 bash</span>

root@770baa5b1071:/<span class="token comment"># ls</span>
bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
<span class="token comment"># 并没有vim命令</span>
root@770baa5b1071:/<span class="token comment"># vim a.txt</span>
bash: vim: <span class="token builtin class-name">command</span> not found
root@770baa5b1071:/<span class="token comment"># apt update        </span>
<span class="token comment"># 安装vim</span>
root@770baa5b1071:/<span class="token comment"># apt install vim -y</span>
<span class="token comment"># 创建并使用vim编辑a.txt</span>
root@770baa5b1071:/<span class="token comment"># vim a.txt</span>
root@770baa5b1071:/<span class="token comment"># cat a.txt </span>
this is <span class="token function">docker</span>
root@770baa5b1071:/<span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>

<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED        STATUS        PORTS                                                  NAMES
770baa5b1071   ubuntu         <span class="token string">&quot;bash&quot;</span>                   <span class="token number">25</span> hours ago   Up <span class="token number">25</span> hours                                                          upbeat_morse
<span class="token comment"># 使用docker commit 命令提交该镜像到本地仓库，和export不同的是commit命令适用于团队版本的迭代合作开发，而export仅仅是导出容器作为镜像备份</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker commit -m &quot;add vim cmd&quot; -a &quot;tom&quot; 770baa5b1071 tom/myubuntu:1.3</span>
sha256:8bc5e004acb81771880401f8d4471f1c27b1e1d990e4217fee1aca535dcbef84
<span class="token comment"># 查看镜像</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY      TAG       IMAGE ID       CREATED         SIZE
tom/myubuntu    <span class="token number">1.3</span>       8bc5e004acb8   <span class="token number">4</span> seconds ago   183MB
ubuntu          latest    ba6acccedd29   <span class="token number">18</span> months ago   <span class="token number">72</span>.8MB
<span class="token comment"># 启动我们带有vim命令的镜像</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -it 8bc5e004acb8 bash</span>
<span class="token comment"># 使用vim命令编辑a.txt，发现内容都还在</span>
root@9958a95cf374:/<span class="token comment"># vim a.txt</span>
<span class="token comment"># 退出容器</span>
root@9958a95cf374:/<span class="token comment"># [root@VM-0-5-centos ~]# </span>

<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED          STATUS          PORTS                                                  NAMES
9958a95cf374   8bc5e004acb8         <span class="token string">&quot;bash&quot;</span>                   <span class="token number">25</span> seconds ago   Up <span class="token number">24</span> seconds                                                          sweet_faraday
770baa5b1071   ba6acccedd29         <span class="token string">&quot;bash&quot;</span>                   <span class="token number">25</span> hours ago     Up <span class="token number">25</span> hours                                                            upbeat_morse
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="小总结" tabindex="-1"><a class="header-anchor" href="#小总结" aria-hidden="true">#</a> 小总结</h4><blockquote><p>Docker中的镜像分层，支持通过扩展现有的镜像，创建新的镜像，类似java继承于一个父类，自己按照需求扩展，新镜像就是从父镜像一层一层叠加生生的。每安装一个软件，就类似在现有的镜像基础上增加一层。</p></blockquote><h3 id="docker本地镜像发布到阿里云" tabindex="-1"><a class="header-anchor" href="#docker本地镜像发布到阿里云" aria-hidden="true">#</a> Docker本地镜像发布到阿里云</h3><ol><li><p>首先进入阿里云的镜像服务网址<a href="https://cr.console.aliyun.com/cn-hangzhou/instances" target="_blank" rel="noopener noreferrer">点击进入<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>创建个人实例并配置密码,密码请牢记。</p></li><li><p>创建命名空间</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304270820521.png" alt="image-20230427082000324" tabindex="0" loading="lazy"><figcaption>image-20230427082000324</figcaption></figure></li><li><p>创建镜像仓库</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304270823400.png" alt="image-20230427082327243" tabindex="0" loading="lazy"><figcaption>image-20230427082327243</figcaption></figure><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304270824675.png" alt="image-20230427082452585" tabindex="0" loading="lazy"><figcaption>image-20230427082452585</figcaption></figure></li><li><p>将本地镜像推送到阿里云</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304270825472.png" alt="image-20230427082543404" tabindex="0" loading="lazy"><figcaption>image-20230427082543404</figcaption></figure></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker login --username=aliyun7367000373 registry.cn-hangzhou.aliyuncs.com</span>
Password: 
Login Succeeded
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY      TAG       IMAGE ID       CREATED         SIZE
tom/myubuntu    <span class="token number">1.3</span>       8bc5e004acb8   <span class="token number">13</span> hours ago    183MB
ubuntu          latest    ba6acccedd29   <span class="token number">18</span> months ago   <span class="token number">72</span>.8MB

<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker tag 8bc5e004acb8 registry.cn-hangzhou.aliyuncs.com/wuluwulu_ah/myubuntu:1.3</span>

<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker push registry.cn-hangzhou.aliyuncs.com/wuluwulu_ah/myubuntu:1.3</span>
The push refers to repository <span class="token punctuation">[</span>registry.cn-hangzhou.aliyuncs.com/wuluwulu_ah/myubuntu<span class="token punctuation">]</span>
f6212982c01a: Pushing <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span>                                           <span class="token punctuation">]</span>  <span class="token number">17</span>.44MB/110.6MB
9f54eef41275: Pushing <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span>                                              <span class="token punctuation">]</span>  <span class="token number">7</span>.079MB/72.78MB

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="拉取阿里云镜像" tabindex="-1"><a class="header-anchor" href="#拉取阿里云镜像" aria-hidden="true">#</a> 拉取阿里云镜像</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull registry.cn-hangzhou.aliyuncs.com/wuluwulu_ah/myubuntu:<span class="token punctuation">[</span>镜像版本号<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>先删除我们本地的镜像，然后再把阿里云的远程仓库的pull下来</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker rmi 8bc5e004acb8 8bc5e004acb8 </span>
Error response from daemon: conflict: unable to delete 8bc5e004acb8 <span class="token punctuation">(</span>must be forced<span class="token punctuation">)</span> - image is referenced <span class="token keyword">in</span> multiple repositories
Error response from daemon: conflict: unable to delete 8bc5e004acb8 <span class="token punctuation">(</span>must be forced<span class="token punctuation">)</span> - image is referenced <span class="token keyword">in</span> multiple repositories
<span class="token comment"># 不能删除，我们使用-f强制删除</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker rmi -f 8bc5e004acb8 8bc5e004acb8</span>
Untagged: tom/myubuntu:1.3
Untagged: registry.cn-hangzhou.aliyuncs.com/wuluwulu_ah/myubuntu:1.3
Untagged: registry.cn-hangzhou.aliyuncs.com/wuluwulu_ah/myubuntu@sha256:95fb29ab9097488857cd3a4ac4685303bb302d60c46d1ebc7597166bc98afa8b
Deleted: sha256:8bc5e004acb81771880401f8d4471f1c27b1e1d990e4217fee1aca535dcbef84
Deleted: sha256:e176caa4478638987d7f11453198d26f0c976c9c5f4b02a2ed450f5531c503a1
Error response from daemon: No such image: 8bc5e004acb8:latest
<span class="token comment"># 删除成功</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY      TAG       IMAGE ID       CREATED         SIZE
ubuntu          latest    ba6acccedd29   <span class="token number">18</span> months ago   <span class="token number">72</span>.8MB
<span class="token comment"># 使用pull命令下载我们的镜像</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker pull registry.cn-hangzhou.aliyuncs.com/wuluwulu_ah/myubuntu:1.3</span>
<span class="token number">1.3</span>: Pulling from wuluwulu_ah/myubuntu
7b1a6ab2e44d: Already exists 
abbc22b898f9: Pull complete 
Digest: sha256:95fb29ab9097488857cd3a4ac4685303bb302d60c46d1ebc7597166bc98afa8b
Status: Downloaded newer image <span class="token keyword">for</span> registry.cn-hangzhou.aliyuncs.com/wuluwulu_ah/myubuntu:1.3
registry.cn-hangzhou.aliyuncs.com/wuluwulu_ah/myubuntu:1.3

<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY                                               TAG       IMAGE ID       CREATED         SIZE
registry.cn-hangzhou.aliyuncs.com/wuluwulu_ah/myubuntu   <span class="token number">1.3</span>       8bc5e004acb8   <span class="token number">13</span> hours ago    183MB
ubuntu                                                   latest    ba6acccedd29   <span class="token number">18</span> months ago   <span class="token number">72</span>.8MB
<span class="token comment"># 启动镜像</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -it 8bc5e004acb8 bash</span>
root@85548c6fe843:/<span class="token comment"># ls</span>
a.txt  bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
root@85548c6fe843:/<span class="token comment"># vim a.txt </span>
root@85548c6fe843:/<span class="token comment"># cat a.txt </span>
this is <span class="token function">docker</span>

awesome
root@85548c6fe843:/<span class="token comment"># [root@VM-0-5-centos ~]# </span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="docker私有库" tabindex="-1"><a class="header-anchor" href="#docker私有库" aria-hidden="true">#</a> Docker私有库</h3><h2 id="容器数据卷" tabindex="-1"><a class="header-anchor" href="#容器数据卷" aria-hidden="true">#</a> 容器数据卷</h2><blockquote><p>开篇提醒：</p><p>Docker挂载主机目录访问如果出现cannot open directory: Permission denied</p><p>解决办法：在挂载目录后多加一个<code>--privileged</code>参数即可</p><p>可以扩大容器的权限解决挂载目录没有权限的问题，即使用该参数容器内部的root用户才拥有root权限，否则容器<code>内部</code>的root只是<code>外部</code>的一个普通用户权限</p></blockquote><h3 id="是什么" tabindex="-1"><a class="header-anchor" href="#是什么" aria-hidden="true">#</a> 是什么？</h3><p>卷就是目录或文件，存在于一个或多个容器中，有docker挂载到容器，但不属于联合文件系统，因此能够绕过Union File System提供一些用户持久存储或数据共享的特性：</p><blockquote><p>卷的设计目的就是<code>数据的持久化</code>，完全独立于容器的生产周期，因此Docker不会在容器删除时删除其挂载的数据卷</p></blockquote><h3 id="能干嘛" tabindex="-1"><a class="header-anchor" href="#能干嘛" aria-hidden="true">#</a> 能干嘛？</h3><p>将运用于运行的环境打包镜像，run后形成容器实例运行，但是我们对数据的要求希望是<code>持久化的</code></p><blockquote><p>Docker容器产生的数据，如果不备份，那么当容器实例删除后，容器内的数据自然也就没有了。</p><p>为了能保存sj在docker中我们使用卷：</p><p>特点：</p><ul><li>数据卷可以在<code>容器之间</code>共享或重用数据</li><li>数据卷中的更改可以直接实时生效！</li><li>数据卷中的更改不会包含在镜像的更新中</li><li>数据卷的生命周期一直持续到没有容器使用它为止</li></ul></blockquote><h3 id="宿主机和容器之间映射添加容器卷" tabindex="-1"><a class="header-anchor" href="#宿主机和容器之间映射添加容器卷" aria-hidden="true">#</a> 宿主机和容器之间映射添加容器卷</h3><p>命令：</p><p><code>docker run -d -v /宿主机绝对路径目录:/容器内目录 --privileged=true 镜像ID</code></p><p>演示：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY                                               TAG       IMAGE ID       CREATED         SIZE
ubuntu                                                   latest    ba6acccedd29   <span class="token number">18</span> months ago   <span class="token number">72</span>.8MB
<span class="token comment"># 运行ubuntu镜像并设置容器卷目录映射</span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -it -v /tmp/host_data:/tmp/docker_data --privileged=true --name=u1 ba6acccedd29</span>

root@9705cb76c40e:/<span class="token comment"># ls</span>
bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
root@9705cb76c40e:/<span class="token comment"># cd tmp/</span>
root@9705cb76c40e:/tmp<span class="token comment"># ls</span>
docker_data
root@9705cb76c40e:/tmp<span class="token comment"># cd docker_data/</span>
root@9705cb76c40e:/tmp/docker_data<span class="token comment"># ls</span>
root@9705cb76c40e:/tmp/docker_data<span class="token comment"># echo &quot;hello&quot; &gt;&gt; dockerin.txt</span>
root@9705cb76c40e:/tmp/docker_data<span class="token comment"># ls</span>
dockerin.txt
root@9705cb76c40e:/tmp/docker_data<span class="token comment"># cat dockerin.txt </span>
hello

<span class="token comment"># 回到宿主机</span>
root@9705cb76c40e:/tmp/docker_data<span class="token comment"># [root@VM-0-5-centos ~]# </span>
<span class="token punctuation">[</span>root@VM-0-5-centos ~<span class="token punctuation">]</span><span class="token comment"># cd /tmp/host_data/</span>
<span class="token punctuation">[</span>root@VM-0-5-centos host_data<span class="token punctuation">]</span><span class="token comment"># ls</span>
dockerin.txt
<span class="token punctuation">[</span>root@VM-0-5-centos host_data<span class="token punctuation">]</span><span class="token comment"># cat dockerin.txt </span>
hello
<span class="token punctuation">[</span>root@VM-0-5-centos host_data<span class="token punctuation">]</span><span class="token comment"># echo &quot;awesome&quot; &gt;&gt; dockerin.txt </span>
<span class="token punctuation">[</span>root@VM-0-5-centos host_data<span class="token punctuation">]</span><span class="token comment"># cat dockerin.txt </span>
hello
awesome
<span class="token punctuation">[</span>root@VM-0-5-centos host_data<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED         STATUS         PORTS                                                  NAMES
9705cb76c40e   ba6acccedd29         <span class="token string">&quot;bash&quot;</span>                   <span class="token number">2</span> minutes ago   Up <span class="token number">2</span> minutes                                                          u1
<span class="token punctuation">[</span>root@VM-0-5-centos host_data<span class="token punctuation">]</span><span class="token comment"># docker exec -it 9705cb76c40e bash</span>
root@9705cb76c40e:/<span class="token comment"># cd tmp/</span>
root@9705cb76c40e:/tmp<span class="token comment"># cd docker_data/</span>
root@9705cb76c40e:/tmp/docker_data<span class="token comment"># ls</span>
dockerin.txt
root@9705cb76c40e:/tmp/docker_data<span class="token comment"># cat dockerin.txt </span>
hello
awesome
root@9705cb76c40e:/tmp/docker_data<span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以使用<code>docker inspect 容器ID</code>查看详细信息中的Mounts挂载信息</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;Id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;9705cb76c40e4a5f79ec8305cd7cc61575130b13ec16356c3b05eb95056d1ff0&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Created&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-04-27T11:55:01.575632782Z&quot;</span><span class="token punctuation">,</span>
      
      ...
      
        <span class="token property">&quot;Mounts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bind&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/tmp/host_data&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Destination&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/tmp/docker_data&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Mode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;RW&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Propagation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rprivate&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      
      ...
      
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="容器和宿主机之间数据共享" tabindex="-1"><a class="header-anchor" href="#容器和宿主机之间数据共享" aria-hidden="true">#</a> 容器和宿主机之间数据共享</h3><ol><li>docker修改，主机同步获得</li><li>主机修改，docker同步获得</li><li>docker容器stop，主机修改，docker容器重启仍然会同步</li></ol><h3 id="容器卷ro和rw读写规则" tabindex="-1"><a class="header-anchor" href="#容器卷ro和rw读写规则" aria-hidden="true">#</a> 容器卷ro和rw读写规则</h3><p>上面的演示我们没有指定读写规则，则使用默认的读写规则：rw</p><p>也就是我们执行的命令相当于：docker run -it -v /tmp/host_data:/tmp/docker_data<code>:rw</code> --privilege=true --name=u1 镜像ID</p><ul><li><p>rw：容器内部是可读可写的</p></li><li><p>ro：容器内部是只读的</p><blockquote><p>容器内部修改的时候会出现Read-only file System 只读提示</p></blockquote></li></ul><h3 id="容器卷的继承" tabindex="-1"><a class="header-anchor" href="#容器卷的继承" aria-hidden="true">#</a> 容器卷的继承</h3><blockquote><p>容器2继承容器1的卷规则</p><p><code>docker run -it --volumes-from 父类 --privilege=true --name u2 ubuntu</code></p><p>注意：容器2<code>不会</code>因为容器1停止了就不同步宿主机数据了</p></blockquote><h2 id="docker软件安装" tabindex="-1"><a class="header-anchor" href="#docker软件安装" aria-hidden="true">#</a> Docker软件安装</h2><h3 id="总体步骤" tabindex="-1"><a class="header-anchor" href="#总体步骤" aria-hidden="true">#</a> 总体步骤</h3><ol><li>搜索镜像</li><li>拉取镜像</li><li>查看镜像</li><li>启动镜像(服务端口映射)</li><li>停止镜像</li><li>移除镜像</li></ol><h3 id="安装tomcat" tabindex="-1"><a class="header-anchor" href="#安装tomcat" aria-hidden="true">#</a> 安装Tomcat</h3><ol><li><p>搜索镜像</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> search tomcat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>拉取镜像</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull tomcat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>查看镜像</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> images tomcat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>启动镜像</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8080</span>:8080 <span class="token parameter variable">--name</span> t1 tomcat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>访问8080端口</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304272049964.png" alt="image-20230427204922799" tabindex="0" loading="lazy"><figcaption>image-20230427204922799</figcaption></figure></li></ol><blockquote><p>由于安装的是最新版的tomcat，内部的目录发生了变化，我们需要使用bash进入tomcat容器对应的系统内部把webapps这个空的文件夹删除掉，然后把webapps.dist修改为webapps再访问8080端口即可出现tom猫</p></blockquote><blockquote><p>推荐安装tomcat8版本就足够了</p><p>这次我们直接使用run命令，本地没有镜像会自动执行pull命令拉取远程仓库</p><p><code>docker run -d -p 8080:8080 --name tomcat8 billygoo/tomcat8-jdk8</code></p><p>这次我们再打开浏览器直接访问8080端口：</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202304272059783.png" alt="image-20230427205908638" tabindex="0" loading="lazy"><figcaption>image-20230427205908638</figcaption></figure></blockquote><h3 id="安装mysql" tabindex="-1"><a class="header-anchor" href="#安装mysql" aria-hidden="true">#</a> 安装MySQL</h3><ol><li><p>使用MySQL镜像</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 <span class="token parameter variable">-d</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> mysql:5.7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>查看容器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">ps</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>进入容器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> 容器ID <span class="token function">bash</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>连接容器中的MySQL</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><blockquote><p>我们需要解决两个问题：</p><ul><li>中文乱码</li><li>数据备份(数据卷)</li></ul></blockquote><ol><li>启动mysql，并挂载容器数据卷</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 <span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token parameter variable">-v</span> /root/mysql/log:/var/log/mysql <span class="token parameter variable">-v</span> /root/mysql/data:/var/lib/mysql <span class="token parameter variable">-v</span> /root/mysql/conf:/etc/mysql/conf.d <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token parameter variable">--name</span> mysql mysql:5.7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li><p>在本机的<code>/root/mysql/conf</code>中新建<code>my.cnf</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>client<span class="token punctuation">]</span>
<span class="token assign-left variable">default_character_set</span><span class="token operator">=</span>utf8
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
collation_server <span class="token operator">=</span> utf8_general_ci
character_set_server <span class="token operator">=</span> utf8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>重启MySQL容器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> restart mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>进入容器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mysql <span class="token function">bash</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>连接MySQL</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>检查字符集是否被修改为utf8</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>SHOW VARIABLES LIKE <span class="token string">&#39;character%&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305040849800.png" alt="image-20230504084900603" style="zoom:50%;"></li><li><p>建库建表，测试中文数据</p></li><li><p>删除容器再重新来一次，数据还会存在吗？</p></li></ol><h3 id="安装redis" tabindex="-1"><a class="header-anchor" href="#安装redis" aria-hidden="true">#</a> 安装Redis</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull redis:6.0.8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">6379</span>:6379 redis:6.0.8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> redis容器ID <span class="token function">bash</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>redis-cli
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">set</span> k1 v1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>get k1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>以上是入门级的命令；下面我们自定义配置文件并使用数据卷映射数据</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> redis容器ID
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>创建默认配置文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> redis
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> redis.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>把下面的默认配置文件复制到该文件</p><p><a href="https://redis.io/docs/management/config-file/" target="_blank" rel="noopener noreferrer">https://redis.io/docs/management/config-file/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>需要修改的地方：</p><ul><li><p>开启redis密码验证</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>requirepass <span class="token number">123</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>允许redis外地连接 必须</p><p>注释掉 <code># bind 127.0.0.1</code></p></li><li><p>daemonize no</p><p>将daemonize yes注释起来或者daemonize no设置，因为改配置和docker run中-d参数冲突，会导致容器一直启动失败</p></li></ul><p>启动redis</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">6377</span>:6379 <span class="token parameter variable">--name</span> my_redis <span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token parameter variable">-v</span> /root/redis/redis.conf:/etc/redis/redis.conf <span class="token parameter variable">-v</span> /root/redis/data:/data <span class="token parameter variable">-d</span> redis:6.0.8 redis-server /etc/redis/redis.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> redis容器ID <span class="token function">bash</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="安装nginx" tabindex="-1"><a class="header-anchor" href="#安装nginx" aria-hidden="true">#</a> 安装Nginx</h3><p>略</p><h2 id="redis高级篇" tabindex="-1"><a class="header-anchor" href="#redis高级篇" aria-hidden="true">#</a> Redis高级篇</h2><h3 id="安装mysql主从复制" tabindex="-1"><a class="header-anchor" href="#安装mysql主从复制" aria-hidden="true">#</a> 安装MySQL主从复制</h3><h4 id="主服务器3307" tabindex="-1"><a class="header-anchor" href="#主服务器3307" aria-hidden="true">#</a> 主服务器3307</h4><p>启动MySQL容器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">3307</span>:3306 <span class="token parameter variable">--name</span> mysql-master <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mysql/mysql-master/log:/var/log/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mysql/mysql-master/data:/var/lib/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mysql/mysql-master/conf:/etc/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> mysql:5.7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在配置目录<code>/root/mysql/mysql-master/conf</code>下添加配置</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token comment">## 设置server_id，同一局域网中需要唯一</span>
<span class="token assign-left variable">server_id</span><span class="token operator">=</span><span class="token number">101</span>
<span class="token comment">## 指定不需要同步的数据库名称</span>
binlog-ignore-db<span class="token operator">=</span>mysql
<span class="token comment">## 开启二进制日志功能</span>
log-bin<span class="token operator">=</span>mall-mysql-bin
<span class="token comment">## 设置二进制日志使用内存大小（事务）</span>
<span class="token assign-left variable">binlog_cache_size</span><span class="token operator">=</span>1M
<span class="token comment">## 设置使用的二进制日志格式（mixed,statement,row）</span>
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>mixed
<span class="token comment">## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span>
<span class="token assign-left variable">expire_logs_days</span><span class="token operator">=</span><span class="token number">7</span>
<span class="token comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span>
<span class="token comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span>
<span class="token assign-left variable">slave_skip_errors</span><span class="token operator">=</span><span class="token number">1062</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启MySQL</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> restart mysql-master
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>进入MySQL容器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mysql-master <span class="token function">bash</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>进入MySQL</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>创建数据同步用户</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE USER &#39;slave&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT REPLICATION SLAVE,REPLICATION CLIENT ON *.* TO &#39;slave&#39;@&#39;%&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305051733102.png" alt="image-20230505173322917" tabindex="0" loading="lazy"><figcaption>image-20230505173322917</figcaption></figure><h4 id="从服务器3308" tabindex="-1"><a class="header-anchor" href="#从服务器3308" aria-hidden="true">#</a> 从服务器3308</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">3308</span>:3306 <span class="token parameter variable">--name</span> mysql-slave <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mysql/mysql-slave/log:/var/log/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mysql/mysql-slave/data:/var/lib/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/mysql/mysql-slave/conf:/etc/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> mysql:5.7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">ps</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305051743484.png" alt="image-20230505174341398" tabindex="0" loading="lazy"><figcaption>image-20230505174341398</figcaption></figure><p>进行配置</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> mysql/mysql-slave/conf/
<span class="token function">vim</span> my.cnf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token comment">## 设置server_id，同一局域网中需要唯一</span>
<span class="token assign-left variable">server_id</span><span class="token operator">=</span><span class="token number">102</span>
<span class="token comment">## 指定不需要同步的数据库名称</span>
binlog-ignore-db<span class="token operator">=</span>mysql
<span class="token comment">## 开启二进制日志功能，以备Slave作为其它数据库实例的Master时使用</span>
log-bin<span class="token operator">=</span>mall-mysql-slave1-bin
<span class="token comment">## 设置二进制日志使用内存大小（事务）</span>
<span class="token assign-left variable">binlog_cache_size</span><span class="token operator">=</span>1M
<span class="token comment">## 设置使用的二进制日志格式（mixed,statement,row）</span>
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>mixed
<span class="token comment">## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span>
<span class="token assign-left variable">expire_logs_days</span><span class="token operator">=</span><span class="token number">7</span>
<span class="token comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span>
<span class="token comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span>
<span class="token assign-left variable">slave_skip_errors</span><span class="token operator">=</span><span class="token number">1062</span>
<span class="token comment">## relay_log配置中继日志</span>
<span class="token assign-left variable">relay_log</span><span class="token operator">=</span>mall-mysql-relay-bin
<span class="token comment">## log_slave_updates表示slave将复制事件写进自己的二进制日志</span>
<span class="token assign-left variable">log_slave_updates</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">## slave设置为只读（具有super权限的用户除外）</span>
<span class="token assign-left variable">read_only</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启从MySQL</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> restart mysql-slave
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>进入主MySQL查看主从同步状态</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mysql-master <span class="token function">bash</span>

mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span>
Enter password: 
Welcome to the MySQL monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MySQL connection <span class="token function">id</span> is <span class="token number">3</span>
Server version: <span class="token number">5.7</span>.36-log MySQL Community Server <span class="token punctuation">(</span>GPL<span class="token punctuation">)</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2021</span>, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="token string">&#39;help;&#39;</span> or <span class="token string">&#39;\h&#39;</span> <span class="token keyword">for</span> help. Type <span class="token string">&#39;\c&#39;</span> to <span class="token function">clear</span> the current input statement.

mysql<span class="token operator">&gt;</span> show master status<span class="token punctuation">;</span>
+-----------------------+----------+--------------+------------------+-------------------+
<span class="token operator">|</span> File                  <span class="token operator">|</span> Position <span class="token operator">|</span> Binlog_Do_DB <span class="token operator">|</span> Binlog_Ignore_DB <span class="token operator">|</span> Executed_Gtid_Set <span class="token operator">|</span>
+-----------------------+----------+--------------+------------------+-------------------+
<span class="token operator">|</span> mall-mysql-bin.000001 <span class="token operator">|</span>      <span class="token number">617</span> <span class="token operator">|</span>              <span class="token operator">|</span> mysql            <span class="token operator">|</span>                   <span class="token operator">|</span>
+-----------------------+----------+--------------+------------------+-------------------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305051753915.png" alt="image-20230505175302827" tabindex="0" loading="lazy"><figcaption>image-20230505175302827</figcaption></figure><p>进入mysql-slave容器，配置主从复制</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@VM-0-5-centos conf<span class="token punctuation">]</span><span class="token comment"># docker exec -it mysql-slave bash</span>
root@abe2b935087d:/<span class="token comment"># mysql -uroot -p</span>
Enter password: 
Welcome to the MySQL monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MySQL connection <span class="token function">id</span> is <span class="token number">2</span>
Server version: <span class="token number">5.7</span>.36-log MySQL Community Server <span class="token punctuation">(</span>GPL<span class="token punctuation">)</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2021</span>, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="token string">&#39;help;&#39;</span> or <span class="token string">&#39;\h&#39;</span> <span class="token keyword">for</span> help. Type <span class="token string">&#39;\c&#39;</span> to <span class="token function">clear</span> the current input statement.

mysql<span class="token operator">&gt;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在从数据库中配置主从复制</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>change master to master_host=&#39;宿主机ip&#39;, master_user=&#39;slave&#39;, master_password=&#39;123456&#39;, master_port=3307, master_log_file=&#39;mall-mysql-bin.000001&#39;, master_log_pos=617, master_connect_retry=30;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>· 主从复制命令参数说明</p><p>master_host：主数据库的IP地址；</p><p>master_port：主数据库的运行端口；</p><p>master_user：在主数据库创建的用于同步数据的用户账号；</p><p>master_password：在主数据库创建的用于同步数据的用户密码；</p><p>master_log_file：指定从数据库要复制数据的日志文件，通过查看主数据的状态，获取File参数；</p><p>master_log_pos：指定从数据库从哪个位置开始复制数据，通过查看主数据的状态，获取Position参数；</p><p>master_connect_retry：连接失败重试的时间间隔，单位为秒。</p></blockquote><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305051802358.png" alt="image-20230505180235258" tabindex="0" loading="lazy"><figcaption>image-20230505180235258</figcaption></figure><p>在从数据库中查看主从同步状态</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>show slave status \G;
# \G 可以以key:value格式显示结果
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305051805979.png" alt="image-20230505180529882" tabindex="0" loading="lazy"><figcaption>image-20230505180529882</figcaption></figure><p>在从数据库中开启主从同步</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>start slave;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查看从数据库状态</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305051808082.png" alt="image-20230505180800979" tabindex="0" loading="lazy"><figcaption>image-20230505180800979</figcaption></figure><blockquote><p>注意如果你的Slave_IO_Running和我一样是Connecting说明正在连接中，大概率是云服务器的防火墙(安全组)没有放开，只需要把3307端口放开,再次<code>start slave</code>即可</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305051819002.png" alt="image-20230505181940900" tabindex="0" loading="lazy"><figcaption>image-20230505181940900</figcaption></figure><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305051820643.png" alt="image-20230505182001529" tabindex="0" loading="lazy"><figcaption>image-20230505182001529</figcaption></figure></blockquote><p>主从复制测试</p><ul><li>主机新建库-使用库-新建表-插入数据</li><li>从机使用库-查看记录</li><li>ok</li></ul><h3 id="安装redis集群-大厂面试题-分布式存储案例" tabindex="-1"><a class="header-anchor" href="#安装redis集群-大厂面试题-分布式存储案例" aria-hidden="true">#</a> 安装Redis集群(大厂面试题-分布式存储案例)</h3><p>· cluster(集群)模式-docker版 哈希槽分区进行亿级数据存储</p><p>· 面试题</p><p>· 1~2亿条数据需要缓存，请问如何设计这个存储案例</p><p>· 回答</p><p>· 单机单台100%不可能，肯定是分布式存储，用redis如何落地？</p><p>· 上述问题阿里P6~P7工程案例和场景设计类必考题目， 一般业界有3种解决方案</p><h4 id="哈希取余分区" tabindex="-1"><a class="header-anchor" href="#哈希取余分区" aria-hidden="true">#</a> 哈希取余分区</h4><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305161816075.png" alt="image-20230516181627976" tabindex="0" loading="lazy"><figcaption>image-20230516181627976</figcaption></figure><table><thead><tr><th>2亿条记录就是2亿个k,v，我们单机不行必须要分布式多机，假设有3台机器构成一个集群，用户每次读写操作都是根据公式：hash(key) % N个机器台数，计算出哈希值，用来决定数据映射到哪一个节点上。</th></tr></thead><tbody><tr><td>优点： 简单粗暴，直接有效，只需要预估好数据规划好节点，例如3台、8台、10台，就能保证一段时间的数据支撑。使用Hash算法让固定的一部分请求落到同一台服务器上，这样每台服务器固定处理一部分请求（并维护这些请求的信息），起到负载均衡+分而治之的作用。</td></tr><tr><td>缺点： 原来规划好的节点，进行扩容或者缩容就比较麻烦了额，不管扩缩，每次数据变动导致节点有变动，映射关系需要重新进行计算，在服务器个数固定不变时没有问题，如果需要弹性扩容或故障停机的情况下，原来的取模公式就会发生变化：Hash(key)/3会变成Hash(key) /?。此时地址经过取余运算的结果将发生很大变化，根据公式获取的服务器也会变得不可控。某个redis机器宕机了，由于台数数量变化，会导致hash取余全部数据重新洗牌。</td></tr></tbody></table><p>· 缺点那？？？</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305161816096.png" alt="image-20230516181647992" tabindex="0" loading="lazy"><figcaption>image-20230516181647992</figcaption></figure><table><thead><tr><th></th></tr></thead><tbody><tr><td>缺点：</td></tr><tr><td>原来规划好的节点，进行扩容或者缩容就比较麻烦了额，不管扩缩，每次数据变动导致节点有变动，映射关系需要重新进行计算，在服务器个数固定不变时没有问题，如果需要弹性扩容或故障停机的情况下，原来的取模公式就会发生变化：Hash(key)/3会变成Hash(key) /?。此时地址经过取余运算的结果将发生很大变化，根据公式获取的服务器也会变得不可控。某个redis机器宕机了，由于台数数量变化，会导致hash取余全部数据重新洗牌。</td></tr></tbody></table><h4 id="一致性哈希算法分区" tabindex="-1"><a class="header-anchor" href="#一致性哈希算法分区" aria-hidden="true">#</a> 一致性哈希算法分区</h4><p>· 是什么</p><p>一致性Hash算法背景</p><p>一致性哈希算法在1997年由麻省理工学院中提出的，设计目标是为了解决</p><p>分布式缓存数据变动和映射问题，某个机器宕机了，分母数量改变了，自然取余数不OK了。</p><p>· 能干嘛</p><p>· 提出一致性Hash解决方案。 目的是<code>当服务器个数发生变动时， 尽量减少影响客户端到服务器的映射关系</code></p><p><strong>·</strong> <em><strong>*3大步骤*</strong></em></p><p>· 算法构建一致性哈希环</p><p>一致性哈希环</p><p>一致性哈希算法必然有个hash函数并按照算法产生hash值，这个算法的所有可能哈希值会构成一个全量集，这个集合可以成为一个hash空间[0,2^32-1]，这个是一个线性空间，但是在算法中，我们通过适当的逻辑控制将它首尾相连(0 = 2^32),这样让它逻辑上形成了一个环形空间。</p><p>它也是按照使用取模的方法，前面笔记介绍的节点取模法是对节点（服务器）的数量进行取模。而<code>一致性Hash算法是对2^32取模</code>，简单来说，一致性Hash算法将整个哈希值空间组织成一个虚拟的圆环，如假设某哈希函数H的值空间为0-2<sup>32-1（即哈希值是一个32位无符号整形），整个哈希环如下图：整个空间按顺时针方向组织，圆环的正上方的点代表0，0点右侧的第一个点代表1，以此类推，2、3、4、……直到2</sup>32-1，也就是说0点左侧的第一个点代表2^32-1， 0和2<sup>32-1在零点中方向重合，我们把这个由2</sup>32个点组成的圆环称为Hash环。</p><p>· 服务器IP节点映射</p><p>节点映射</p><p>将集群中各个IP节点映射到环上的某一个位置。</p><p>将各个服务器使用Hash进行一个哈希，具体可以选择服务器的IP或主机名作为关键字进行哈希，这样每台机器就能确定其在哈希环上的位置。假如4个节点NodeA、B、C、D，经过IP地址的哈希函数计算(hash(ip))，使用IP地址哈希后在环空间的位置如下：</p><p>· key落到服务器的落键规则</p><p>当我们需要存储一个kv键值对时，首先计算key的hash值，hash(key)，将这个key使用相同的函数Hash计算出哈希值并确定此数据在环上的位置，<em><strong>*从此位置沿环顺时针*</strong></em><em><strong>*“*</strong></em><em><strong>*行走*</strong></em><em><strong>*”*</strong></em>，<code>第一台遇到的服务器就是其应该定位到的服务器，并将该键值对存储在该节点上</code>。</p><p>如我们有Object A、Object B、Object C、Object D四个数据对象，经过哈希计算后，在环空间上的位置如下：根据一致性Hash算法，数据A会被定为到Node A上，B被定为到Node B上，C被定为到Node C上，D被定为到Node D上。</p><p>· 优点</p><p>· 一致性哈希算法的容错性</p><p><em><strong>*容错性*</strong></em></p><p>假设Node C宕机，可以看到此时对象A、B、D不会受到影响，只有C对象被重定位到Node D。一般的，在一致性Hash算法中，如果一台服务器不可用，则受影响的数据仅仅是此服务器到其环空间中前一台服务器（即沿着逆时针方向行走遇到的第一台服务器）之间数据，其它不会受到影响。简单说，<code>就是C挂了，受到影响的只是B、C之间的数据，并且这些数据会转移到D进行存储</code>。</p><p>· 一致性哈希算法的****扩展性****</p><p>扩展性</p><p>数据量增加了，需要增加一台节点NodeX，X的位置在A和B之间，那收到影响的也就是A到X之间的数据，重新把A到X的数据录入到X上即可，</p><p>不会导致hash取余全部数据重新洗牌。</p><p>· 缺点</p><p>· 一致性哈希算法的数据倾斜问题</p><p><code>Hash环的数据倾斜问题</code></p><p>一致性Hash算法在服务****节点太少时*<em><strong>，容易因为节点分布不均匀而造成</strong></em>*数据倾斜****（被缓存的对象大部分集中缓存在某一台服务器上）问题，</p><p>例如系统中只有两台服务器：</p><p>· 小总结</p><p>为了在节点数目发生改变时尽可能少的迁移数据</p><p>将所有的存储节点排列在收尾相接的Hash环上，每个key在计算Hash后会顺时针找到临近的存储节点存放。</p><p>而当有节点加入或退出时仅影响该节点在Hash环上顺时针相邻的后续节点。</p><p>优点</p><p>加入和删除节点只影响哈希环中顺时针方向的相邻的节点，对其他节点无影响。</p><p>缺点</p><p>数据的分布和节点的位置有关，因为这些节点不是均匀的分布在哈希环上的，所以数据在进行存储时达不到均匀分布的效果。</p><h4 id="哈希槽分区" tabindex="-1"><a class="header-anchor" href="#哈希槽分区" aria-hidden="true">#</a> 哈希槽分区</h4><p>哈希槽分区</p><p>1 为什么出现</p><blockquote><p>因为一致性哈希算法的数据倾斜问题</p></blockquote><p>哈希槽实质就是一个数组，数组[0,2^14 -1]形成hash slot空间。</p><p>2 能干什么</p><p>解决均匀分配的问题，在数据和节点之间又加入了一层，把这层称为哈希槽（slot），用于管理数据和节点之间的关系，现在就相当于节点上放的是槽，槽里放的是数据。</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305161814348.png" alt="image-20230516181403257" tabindex="0" loading="lazy"><figcaption>image-20230516181403257</figcaption></figure><p>槽解决的是粒度问题，相当于把粒度变大了，这样便于数据移动。</p><p>哈希解决的是映射问题，使用key的哈希值来计算所在的槽，便于数据分配。</p><p>3 多少个hash槽</p><p>一个集群只能有16384个槽，编号0-16383（0-2^14-1）。这些槽会分配给集群中的所有主节点，分配策略没有要求。可以指定哪些编号的槽分配给哪个主节点。集群会记录节点和槽的对应关系。解决了节点和槽的关系后，接下来就需要对key求哈希值，然后对16384取余，余数是几key就落入对应的槽里。slot = CRC16(key) % 16384。以槽为单位移动数据，因为槽的数目是固定的，处理起来比较容易，这样数据移动问题就解决了。</p><p>哈希槽计算</p><p>Redis 集群中内置了 16384 个哈希槽，redis 会<code>根据节点数量大致均等的将哈希槽映射到不同的节点</code>。当需要在 Redis 集群中放置一个 key-value时，redis 先对 key 使用 crc16 算法算出一个结果，然后把结果对 16384 求余数，这样每个 key 都会对应一个编号在 0-16383 之间的哈希槽，也就是映射到某个节点上。如下代码，key之A 、B在Node2， key之C落在Node3上</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305161813843.png" alt="image-20230516181346598" tabindex="0" loading="lazy"><figcaption>image-20230516181346598</figcaption></figure><h5 id="redis-cluster是如何分片的" tabindex="-1"><a class="header-anchor" href="#redis-cluster是如何分片的" aria-hidden="true">#</a> Redis Cluster是如何分片的？</h5><blockquote><p>类似的问题：</p><ul><li>Redis Cluster中的数据是如何分布的？</li><li>如何确定给定key应该分布在哪个哈希槽中？</li></ul></blockquote><p>Redis Cluster采用的是<strong>哈希槽分区</strong>，每一个键值对都属于一个<strong>hash slot</strong>(哈希槽)</p><p>Redis Cluster 通常有16384个哈希槽，要计算指定的key应分布到哪个哈希槽中，我们只需要先对每一个key计算CRC-16校验码，然后再对这个校验码16384取模，得到的值就是key对应的哈希槽</p><blockquote><p>HASH_SLOT = CRC16(key) % NUMBER_OF_SLOTS</p></blockquote><p>创建并初始化Redis Cluster的时候，redis会自动平均分配这16384个槽到各个master节点，不需要我们手动分配。如果想手动调整，redis cluster也提供了相关的命令<code>ADDSLOTS</code>、<code>ADDSLOTS RANGE</code></p><h5 id="_3主3从redis集群扩缩容配置案例架构说明" tabindex="-1"><a class="header-anchor" href="#_3主3从redis集群扩缩容配置案例架构说明" aria-hidden="true">#</a> 3主3从redis集群扩缩容配置案例架构说明</h5><ul><li><p>新建6个docker容器redis实例</p><ul><li><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> redis-node-1 <span class="token parameter variable">--net</span> <span class="token function">host</span> <span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token parameter variable">-v</span> /data/redis/share/redis-node-1:/data redis:6.0.8 --cluster-enabled <span class="token function">yes</span> <span class="token parameter variable">--appendonly</span> <span class="token function">yes</span> <span class="token parameter variable">--port</span> <span class="token number">6381</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> redis-node-2 <span class="token parameter variable">--net</span> <span class="token function">host</span> <span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token parameter variable">-v</span> /data/redis/share/redis-node-2:/data redis:6.0.8 --cluster-enabled <span class="token function">yes</span> <span class="token parameter variable">--appendonly</span> <span class="token function">yes</span> <span class="token parameter variable">--port</span> <span class="token number">6382</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> redis-node-3 <span class="token parameter variable">--net</span> <span class="token function">host</span> <span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token parameter variable">-v</span> /data/redis/share/redis-node-3:/data redis:6.0.8 --cluster-enabled <span class="token function">yes</span> <span class="token parameter variable">--appendonly</span> <span class="token function">yes</span> <span class="token parameter variable">--port</span> <span class="token number">6383</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> redis-node-4 <span class="token parameter variable">--net</span> <span class="token function">host</span> <span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token parameter variable">-v</span> /data/redis/share/redis-node-4:/data redis:6.0.8 --cluster-enabled <span class="token function">yes</span> <span class="token parameter variable">--appendonly</span> <span class="token function">yes</span> <span class="token parameter variable">--port</span> <span class="token number">6384</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> redis-node-5 <span class="token parameter variable">--net</span> <span class="token function">host</span> <span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token parameter variable">-v</span> /data/redis/share/redis-node-5:/data redis:6.0.8 --cluster-enabled <span class="token function">yes</span> <span class="token parameter variable">--appendonly</span> <span class="token function">yes</span> <span class="token parameter variable">--port</span> <span class="token number">6385</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> redis-node-6 <span class="token parameter variable">--net</span> <span class="token function">host</span> <span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token parameter variable">-v</span> /data/redis/share/redis-node-6:/data redis:6.0.8 --cluster-enabled <span class="token function">yes</span> <span class="token parameter variable">--appendonly</span> <span class="token function">yes</span> <span class="token parameter variable">--port</span> <span class="token number">6386</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul><p>如果运行成功，效果如下</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305062059861.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><blockquote><p>命令分步解释</p><p>· docker run</p><p>· 创建并运行docker容器实例</p><p>· --name redis-node-6</p><p>· 容器名字</p><p>· --net host</p><p>· 使用宿主机的IP和端口，默认</p><p>· --privileged=true</p><p>· 获取宿主机root用户权限</p><p>· -v /data/redis/share/redis-node-6:/data</p><p>· 容器卷，宿主机地址:docker内部地址</p><p>· redis:6.0.8</p><p>· redis镜像和版本号</p><p>· --cluster-enabled yes</p><p>· 开启redis集群</p><p>· --appendonly yes</p><p>· 开启持久化</p><p>· --port 6386</p><p>· redis端口号</p><p>· 进入容器redis-node-1并为6台机器构建集群关系</p><p>· 进入容器</p><p>· docker exec -it redis-node-1 /bin/bash</p></blockquote><ul><li><strong>构建主从关系</strong></li></ul><blockquote><p>注意，进入docker容器后才能执行一下命令，且注意自己的真实IP地址</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>redis-cli <span class="token parameter variable">--cluster</span> create <span class="token number">192.168</span>.111.147:6381 <span class="token number">192.168</span>.111.147:6382 <span class="token number">192.168</span>.111.147:6383 <span class="token number">192.168</span>.111.147:6384 <span class="token number">192.168</span>.111.147:6385 <span class="token number">192.168</span>.111.147:6386 --cluster-replicas <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>--cluster-replicas 1 表示为每个master创建一个slave节点</p><p>注意这里的slave不对外提供读服务，主要用来保障master的高可用，当master出现故障的时候替代它。</p></blockquote><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071459651.png" alt="image-20230507145953605" tabindex="0" loading="lazy"><figcaption>image-20230507145953605</figcaption></figure><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071501076.png" alt="image-20230507150113982" tabindex="0" loading="lazy"><figcaption>image-20230507150113982</figcaption></figure><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071502318.png" alt="image-20230507150200245" tabindex="0" loading="lazy"><figcaption>image-20230507150200245</figcaption></figure><p>一切OK的话，3主3从搞定</p><p>链接进入6381作为切入点，查看集群状态和节点信息</p><ul><li><p><code>cluster info</code></p></li><li><p><code>cluster nodes</code></p></li></ul><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071508934.png" alt="image-20230507150801841" tabindex="0" loading="lazy"><figcaption>image-20230507150801841</figcaption></figure><blockquote><p>根据<code>cluster nodes</code>显示的信息</p><p>可以知道节点的主从关系：</p><table><thead><tr><th>master</th><th>slave</th></tr></thead><tbody><tr><td>redis-node-1 6381 slots:[0-5460]</td><td>redis-node-6 6386</td></tr><tr><td>redis-node-2 6382 slots:[5461-10922]</td><td>redis-node-4 6384</td></tr><tr><td>redis-node-3 6383 slots:[10923-16383]</td><td>redis-node-5 6385</td></tr></tbody></table></blockquote><h5 id="主从容错切换迁移案例" tabindex="-1"><a class="header-anchor" href="#主从容错切换迁移案例" aria-hidden="true">#</a> 主从容错切换迁移案例</h5><p>使用<code>redis-cli -p 6381</code>连接1号节点的redis，添加数据发现：</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071528373.png" alt="image-20230507152858250" tabindex="0" loading="lazy"><figcaption>image-20230507152858250</figcaption></figure><blockquote><p>由于k1和k4通过算法计算得到的slots大于了1号节点的[0-5460]范围，所以需要存到另外的slots槽中</p><p>所以我们连接redis的时候需要使用<code>集群环境连接</code></p></blockquote><p>加入参数-c，优化路由</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071536539.png" alt="image-20230507153601436" tabindex="0" loading="lazy"><figcaption>image-20230507153601436</figcaption></figure><p>· 查看集群信息</p><p>redis-cli --cluster check 192.168.111.147:6381</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071541994.png" alt="image-20230507154132893" tabindex="0" loading="lazy"><figcaption>image-20230507154132893</figcaption></figure><h6 id="容错切换迁移" tabindex="-1"><a class="header-anchor" href="#容错切换迁移" aria-hidden="true">#</a> 容错切换迁移</h6><p>主6381和从机切换，先停止主机6381</p><p>6381主机停了，对应的真实从机上位</p><p>6381作为1号主机分配的从机以实际情况为准，具体是几号机器就是几号</p><p>再次查看集群信息</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071550796.png" alt="image-20230507155005700" tabindex="0" loading="lazy"><figcaption>image-20230507155005700</figcaption></figure><p>6381宕机了，6386上位成为了新的master。</p><p>每次案例下面挂的从机以实际情况为准，具体是几号机器就是几号</p><p>先还原之前的3主3从</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071555611.png" alt="image-20230507155500500" tabindex="0" loading="lazy"><figcaption>image-20230507155500500</figcaption></figure><p>还原最初状态</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071601995.png" alt="image-20230507160144899" tabindex="0" loading="lazy"><figcaption>image-20230507160144899</figcaption></figure><p>主从机器分配情况以实际情况为准</p><p>查看集群状态</p><p><code>redis-cli --cluster check 自己IP:6381</code></p><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071616962.png" alt="image-20230507161630718" style="zoom:50%;"><h5 id="主从扩容案例" tabindex="-1"><a class="header-anchor" href="#主从扩容案例" aria-hidden="true">#</a> 主从扩容案例</h5><p>· 新建6387、6388两个节点+新建后启动+查看是否8节点</p><table><thead><tr><th>docker run -d --name redis-node-7 --net host --privileged=true -v /data/redis/share/redis-node-7:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6387</th></tr></thead><tbody><tr><td>docker run -d --name redis-node-8 --net host --privileged=true -v /data/redis/share/redis-node-8:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6388</td></tr><tr><td>docker ps</td></tr></tbody></table><p>· 进入6387容器实例内部</p><p>· docker exec -it redis-node-7 /bin/bash</p><p>· 将新增的6387节点(空槽号)作为master节点加入原集群</p><p>将新增的6387作为master节点加入集群</p><p>redis-cli --cluster add-node 自己实际IP地址:6387 自己实际IP地址:6381</p><blockquote><p>redis-cli --cluster add-node 129.211.221.155:6387 129.211.221.155:6381</p></blockquote><p>6387 就是将要作为master新增节点</p><p>6381 就是原来集群节点里面的领路人，相当于6387拜拜6381的码头从而找到组织加入集群</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071659889.png" alt="image-20230507165940659" tabindex="0" loading="lazy"><figcaption>image-20230507165940659</figcaption></figure><p>· 检查集群情况第1次</p><p>redis-cli --cluster check 真实ip地址:6381</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071703640.png" alt="image-20230507170337510" tabindex="0" loading="lazy"><figcaption>image-20230507170337510</figcaption></figure><p>重新分派槽号</p><blockquote><p>重新分派槽号命令:</p><p>redis-cli --cluster reshard IP地址:端口号</p><p>redis-cli --cluster reshard 192.168.111.147:6381</p></blockquote><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071710597.png" alt="image-20230507171032442" tabindex="0" loading="lazy"><figcaption>image-20230507171032442</figcaption></figure><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071711192.png" alt="image-20230507171151065" tabindex="0" loading="lazy"><figcaption>image-20230507171151065</figcaption></figure><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071714313.png" alt="image-20230507171440183" tabindex="0" loading="lazy"><figcaption>image-20230507171440183</figcaption></figure><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Moving slot <span class="token number">5461</span> from 8e460b7735bcd677c23f847f1231f7e37b9999d6
Moving slot <span class="token number">5462</span> from 8e460b7735bcd677c23f847f1231f7e37b9999d6
<span class="token comment"># ...</span>
Moving slot <span class="token number">6826</span> from 8e460b7735bcd677c23f847f1231f7e37b9999d6

Moving slot <span class="token number">0</span> from 86245a7dd6da92fe3bf6c16fa1ddd71f71b878e2
Moving slot <span class="token number">1</span> from 86245a7dd6da92fe3bf6c16fa1ddd71f71b878e2
<span class="token comment"># ...</span>
Moving slot <span class="token number">1364</span> from 86245a7dd6da92fe3bf6c16fa1ddd71f71b878e2

Moving slot <span class="token number">10923</span> from 9ad4e87344d36842e19a970eb3290dc93b38210a
Moving slot <span class="token number">10924</span> from 9ad4e87344d36842e19a970eb3290dc93b38210a
<span class="token comment"># ...</span>
Moving slot <span class="token number">12287</span> from 9ad4e87344d36842e19a970eb3290dc93b38210a

Do you want to proceed with the proposed reshard plan <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>? <span class="token function">yes</span>
Moving slot <span class="token number">5461</span> from <span class="token number">129.211</span>.221.155:6382 to <span class="token number">129.211</span>.221.155:6387: 
Moving slot <span class="token number">5462</span> from <span class="token number">129.211</span>.221.155:6382 to <span class="token number">129.211</span>.221.155:6387: 
<span class="token comment">#...</span>
Moving slot <span class="token number">12287</span> from <span class="token number">129.211</span>.221.155:6383 to <span class="token number">129.211</span>.221.155:6387: 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>· 检查集群情况第2次</p><p>redis-cli --cluster check 真实ip地址:6381</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071721745.png" alt="image-20230507172134668" tabindex="0" loading="lazy"><figcaption>image-20230507172134668</figcaption></figure><p>槽号分派说明</p><blockquote><p>为什么6387是3个新的区间，以前的还是连续？</p><p>重新分配成本太高，所以前3家各自匀出来一部分，从6381/6382/6383三个旧节点分别匀出1364个坑位给新节点6387</p></blockquote><p>为主节点6387分配从节点6388</p><p>命令：</p><blockquote><p>redis-cli --cluster add-node ip:新slave端口 ip:新master端口 --cluster-slave --cluster-master-id 新主机节点ID</p></blockquote><blockquote><p><code>redis-cli --cluster add-node 192.168.111.147:6388 192.168.111.147:6387 --cluster-slave --cluster-master-id e4781f644d4a4e4d4b4d107157b9ba8144631451-------这个是6387的编号，按照自己实际情况</code></p></blockquote><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071736635.png" alt="image-20230507173641538" tabindex="0" loading="lazy"><figcaption>image-20230507173641538</figcaption></figure><p>检查集群情况第3次</p><p>redis-cli --cluster check 192.168.111.147:6382</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071734439.png" alt="image-20230507173418219" tabindex="0" loading="lazy"><figcaption>image-20230507173418219</figcaption></figure><h5 id="主从缩容案例" tabindex="-1"><a class="header-anchor" href="#主从缩容案例" aria-hidden="true">#</a> 主从缩容案例</h5><blockquote><p>目的：6387和6388下线</p></blockquote><p>分析：我们应该先删除6388，然后再删除6387</p><p>检查集群情况1获得6388的节点ID</p><p>redis-cli --cluster check ip:6388</p><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071743169.png" alt="image-20230507174317012" style="zoom:50%;"><p><code>0181322b91a2212672fda1b81b3ab6344e1c2da1</code></p><p>将6388删除 从集群中将4号从节点6388删除</p><p>命令：</p><blockquote><p>redis-cli --cluster del-node ip:从机端口 从机6388节点ID</p></blockquote><blockquote><p>redis-cli --cluster del-node ip:6388 0181322b91a2212672fda1b81b3ab6344e1c2da1</p></blockquote><p>redis-cli --cluster check 192.168.111.147:6382</p><p>检查一下发现，6388被删除了，只剩下7台机器了。</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071751671.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>将6387的槽号清空，重新分配，本例将清出来的槽号都给6381</p><blockquote><p>redis-cli --cluster reshard 129.211.221.155:6381</p></blockquote><p>这里其实是操作的整个集群，而不是看到了后面是6381就以为是只操作6381</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071809300.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>检查集群情况第二次</p><p>redis-cli --cluster check 192.168.111.147:6381 4096个槽位都指给6381，它变成了8192个槽位，相当于全部都给6381了，不然要输入3次，一锅端</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071811616.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>将6387删除</p><p>命令：redis-cli --cluster del-node ip:端口 6387节点ID</p><blockquote><p>redis-cli --cluster del-node 129.211.221.155:6387 420cafee6886a04ecf82f4dea6f8a8445ea3208e</p></blockquote><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071815371.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>检查集群情况第三次</p><figure><img src="https://blog-images-1309758663.cos.ap-nanjing.myqcloud.com/202305071815401.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/humeng1010/Java-world/edit/main/src/docker/Docker.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: humeng_mail@163.com">humeng</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">JavaWorld.top</div><div class="vp-copyright">Copyright © 2023 Hu Meng</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-b5397d92.js" defer></script>
  </body>
</html>
